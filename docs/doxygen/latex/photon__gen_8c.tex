\hypertarget{photon__gen_8c}{}\section{/\+Users/mhewitt/python/source/photon\+\_\+gen.c File Reference}
\label{photon__gen_8c}\index{/\+Users/mhewitt/python/source/photon\+\_\+gen.\+c@{/\+Users/mhewitt/python/source/photon\+\_\+gen.\+c}}


Primary routines for creating photons for use in the radiative transfer calculation.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atomic.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}python.\+h\char`\"{}}\newline
Include dependency graph for photon\+\_\+gen.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{photon__gen_8c_a1ca9f64427b2bc5b538fe2fa2501c639}{S\+T\+E\+PS}~100000
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{photon__gen_8c_aa943bd857500a1f2937d8b97d84ff633}{define\+\_\+phot} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, double f1, double f2, long nphot\+\_\+tot, int ioniz\+\_\+or\+\_\+final, int iwind, int freq\+\_\+sampling)
\begin{DoxyCompactList}\small\item\em the controlling routine for creating the underlying photon distribution. \end{DoxyCompactList}\item 
double \hyperlink{photon__gen_8c_addfbba966a4d69bdc71b771e0d7f3cdf}{populate\+\_\+bands} (double f1, double f2, int ioniz\+\_\+or\+\_\+final, int iwind, struct \hyperlink{structxbands}{xbands} $\ast$band)
\begin{DoxyCompactList}\small\item\em Determine how many photons to allocate to each band. \end{DoxyCompactList}\item 
int \hyperlink{photon__gen_8c_a9a0acf2d461c665dc0302defa95ded65}{xdefine\+\_\+phot} (double f1, double f2, int ioniz\+\_\+or\+\_\+final, int iwind)
\begin{DoxyCompactList}\small\item\em calculates the band limited fluxes \& luminosities, and prepares for the producting of photons (by reinitializing the disk, among other things). \end{DoxyCompactList}\item 
int \hyperlink{photon__gen_8c_ab7f1c9362f29a0b44f41cff21494b6df}{xmake\+\_\+phot} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, double f1, double f2, int ioniz\+\_\+or\+\_\+final, int iwind, double weight, int iphot\+\_\+start, int nphotons)
\begin{DoxyCompactList}\small\item\em just makes photons \end{DoxyCompactList}\item 
int \hyperlink{photon__gen_8c_a0bc15d347d507f21da65e37f659de349}{star\+\_\+init} (double freqmin, double freqmax, int ioniz\+\_\+or\+\_\+final, double $\ast$f)
\begin{DoxyCompactList}\small\item\em (r, tstar, freqmin, freqmax, ioniz\+\_\+or\+\_\+final, f) \end{DoxyCompactList}\item 
int \hyperlink{photon__gen_8c_a19e1b27b1fe040ccadcd39a5783c4d60}{photo\+\_\+gen\+\_\+star} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, double \hyperlink{import__spherical_8c_a83175ac8fd9d924ff2bce40c99e88870}{r}, double \hyperlink{import__spherical_8c_afc1637b8a38578a1c95ed9f689476775}{t}, double weight, double f1, double f2, int spectype, int istart, int nphot)
\begin{DoxyCompactList}\small\item\em Generate nphot photons from the star in the frequency interval f1 to f2. \end{DoxyCompactList}\item 
double \hyperlink{photon__gen_8c_a3c3ee1b7657b6c1bc4e6c1e6d8300020}{disk\+\_\+init} (double rmin, double rmax, double m, double mdot, double freqmin, double freqmax, int ioniz\+\_\+or\+\_\+final, double $\ast$ftot)
\begin{DoxyCompactList}\small\item\em calculates the total luminosity and the luminosity between freqqmin and freqmax of the disk. More importantly divides the disk into annulae such that each annulus contributes and equal amount to the lumionosity of the disk (within the frequency limits). Thus initializes the structure \char`\"{}disk\char`\"{}. \end{DoxyCompactList}\item 
int \hyperlink{photon__gen_8c_ac6e59fd8ed9979322e86a14ed34c2851}{photo\+\_\+gen\+\_\+disk} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, double weight, double f1, double f2, int spectype, int istart, int nphot)
\begin{DoxyCompactList}\small\item\em Generate disk photons. \end{DoxyCompactList}\item 
int \hyperlink{photon__gen_8c_a07c7b56c161732c7397e69c4ff4bdb31}{phot\+\_\+gen\+\_\+sum} (filename, mode)
\begin{DoxyCompactList}\small\item\em write information about the disk to a file \end{DoxyCompactList}\item 
double \hyperlink{photon__gen_8c_afb47deaf80a8f3a6f07ab91d843d960e}{bl\+\_\+init} (double lum\+\_\+bl, double t\+\_\+bl, double freqmin, double freqmax, int ioniz\+\_\+or\+\_\+final, double $\ast$f)
\begin{DoxyCompactList}\small\item\em calculate parameters need to intialize the boundary layer (namely the band-\/liminted luminoisity) \end{DoxyCompactList}\item 
int \hyperlink{photon__gen_8c_a663f46d36d6962c7993e4c002442c23b}{photon\+\_\+checks} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, double freqmin, double freqmax, char $\ast$comment)
\begin{DoxyCompactList}\small\item\em Perform some simple checks on the photon distribution just produced. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
double \hyperlink{photon__gen_8c_ab21ea56600a6e1eb09e89816449e09f9}{f1\+\_\+old} = 0
\item 
double \hyperlink{photon__gen_8c_a40d422c86ec453018368d16aa7c079cd}{f2\+\_\+old} = 0
\item 
int \hyperlink{photon__gen_8c_aa454ec9a17879579643258a3855270c3}{iwind\+\_\+old} = 0
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Primary routines for creating photons for use in the radiative transfer calculation. 

\begin{DoxyAuthor}{Author}
ksl 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
May, 2018 
\end{DoxyDate}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{photon__gen_8c_a1ca9f64427b2bc5b538fe2fa2501c639}\label{photon__gen_8c_a1ca9f64427b2bc5b538fe2fa2501c639}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!S\+T\+E\+PS@{S\+T\+E\+PS}}
\index{S\+T\+E\+PS@{S\+T\+E\+PS}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{S\+T\+E\+PS}{STEPS}}
{\footnotesize\ttfamily \#define S\+T\+E\+PS~100000}



Definition at line 801 of file photon\+\_\+gen.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{photon__gen_8c_afb47deaf80a8f3a6f07ab91d843d960e}\label{photon__gen_8c_afb47deaf80a8f3a6f07ab91d843d960e}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!bl\+\_\+init@{bl\+\_\+init}}
\index{bl\+\_\+init@{bl\+\_\+init}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{bl\+\_\+init()}{bl\_init()}}
{\footnotesize\ttfamily double bl\+\_\+init (\begin{DoxyParamCaption}\item[{double}]{lum\+\_\+bl,  }\item[{double}]{t\+\_\+bl,  }\item[{double}]{freqmin,  }\item[{double}]{freqmax,  }\item[{int}]{ioniz\+\_\+or\+\_\+final,  }\item[{double $\ast$}]{f }\end{DoxyParamCaption})}



calculate parameters need to intialize the boundary layer (namely the band-\/liminted luminoisity) 


\begin{DoxyParams}{Parameters}
{\em \mbox{[}in} & out\mbox{]} double lum\+\_\+bl The desired luminosity for the boundary layaer \\
\hline
{\em \mbox{[}in} & out\mbox{]} double t\+\_\+bl The temperature \\
\hline
{\em \mbox{[}in} & out\mbox{]} double freqmin The minimum freqency in the band \\
\hline
{\em \mbox{[}in} & out\mbox{]} double freqmax The maximum freqency in the band \\
\hline
{\em \mbox{[}in} & out\mbox{]} int ioniz\+\_\+or\+\_\+final The spectral type to use in the calucation (N\+OT U\+S\+ED) but see below \\
\hline
{\em \mbox{[}in} & out\mbox{]} double $\ast$ f The band limited luminosity \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The total luminosity
\end{DoxyReturn}
The only thing that is actually calculated here is f, the luminosity within the frequency range that is specified.

This routine calculates the luminosity of the bl within the frequency boundaries. BB functions are assumed. It was derived from the same routine for a star, but here we have assumed that the temperature and the luminosity are known

\paragraph*{Notes}

\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000045}{Bug}]At present bl\+\_\+init assumes a BB regardless of the spectrum. This is not really correct, and is different for what is done in initializing the star\end{DoxyRefDesc}


0703 -\/ ksl -\/ This is rather an odd little routine. As noted all that is calculated is f. ioniz\+\_\+or\+\_\+final is not used, and lum\+\_\+bl which is returned is only the luminosity that was passed. 

Definition at line 1244 of file photon\+\_\+gen.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c_afb47deaf80a8f3a6f07ab91d843d960e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c_afb47deaf80a8f3a6f07ab91d843d960e_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{photon__gen_8c_aa943bd857500a1f2937d8b97d84ff633}\label{photon__gen_8c_aa943bd857500a1f2937d8b97d84ff633}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!define\+\_\+phot@{define\+\_\+phot}}
\index{define\+\_\+phot@{define\+\_\+phot}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{define\+\_\+phot()}{define\_phot()}}
{\footnotesize\ttfamily int define\+\_\+phot (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{double}]{f1,  }\item[{double}]{f2,  }\item[{long}]{nphot\+\_\+tot,  }\item[{int}]{ioniz\+\_\+or\+\_\+final,  }\item[{int}]{iwind,  }\item[{int}]{freq\+\_\+sampling }\end{DoxyParamCaption})}



the controlling routine for creating the underlying photon distribution. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em Phot\+Ptr} & p The structure where all photons are stored \\
\hline
\mbox{\tt in}  & {\em double} & f1 The mininum frequency \\
\hline
\mbox{\tt in}  & {\em double} & f2 The maximum frequency if a uniform distribution \\
\hline
\mbox{\tt in}  & {\em long} & nphot\+\_\+tot The total number of photons that need to be generated to reach the total luminosity, not necessarilly the number of photons which will be generated by the call to define\+\_\+phot, which instead is defined by N\+P\+H\+OT \\
\hline
\mbox{\tt in}  & {\em int} & ioniz\+\_\+or\+\_\+final 0 -\/$>$ this is for the wind ionization calculation, 1-\/$>$ it is for the final spectrum calculation \\
\hline
\mbox{\tt in}  & {\em int} & iwind A variable (see below) that controls the generation of phtons for the wind \\
\hline
\mbox{\tt in}  & {\em int} & freq\+\_\+sampling If 0, generate photons over the full frequency range without banding, else use banding \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
This routine oversees the generation of photons for the radiative transfer calculation. Most of the actual work is done in other routines, particularly xdefine\+\_\+phot). There can be multiple radiation sources (e.\+g the star and a disk)

There are two basic approaches to generating photons. One can sample the entire wavelength interval in which case all photons have the same weight, but photon frequencies are selected based on the the specific luminiosty. In the banded approach, one defines bands in which photons are generated. Specific numbers of photons are are generated in each band, and within a band the photons are selected according the the specific luminosity, but the weights of photons in different bands differ. still used for detailed spectrum calculation. Which of this choices to use is controlled by freq\+\_\+sampling (The weights are established here)

iwind is a variable that determines how or whether to create photons from the wind\+:
\begin{DoxyItemize}
\item -\/1-\/$>$ Do not consider wind photons under any circumstances
\item 0 -\/$>$Consider wind photons. There is no need to recalculate the relative contribution to number of photons from the wind unless the frequencies have changed
\item 1 -\/$>$ Force a recalculation of the fraction of photons from the wind. This is necessary because after each ionization recalculation one needs to recalculate the flux fraction from the wind.
\end{DoxyItemize}

\paragraph*{Notes}

\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000043}{Bug}]Is this correct, have subcycles been removed.\end{DoxyRefDesc}


Definition at line 75 of file photon\+\_\+gen.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{photon__gen_8c_aa943bd857500a1f2937d8b97d84ff633_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=254pt]{photon__gen_8c_aa943bd857500a1f2937d8b97d84ff633_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{photon__gen_8c_a3c3ee1b7657b6c1bc4e6c1e6d8300020}\label{photon__gen_8c_a3c3ee1b7657b6c1bc4e6c1e6d8300020}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!disk\+\_\+init@{disk\+\_\+init}}
\index{disk\+\_\+init@{disk\+\_\+init}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{disk\+\_\+init()}{disk\_init()}}
{\footnotesize\ttfamily double disk\+\_\+init (\begin{DoxyParamCaption}\item[{double}]{rmin,  }\item[{double}]{rmax,  }\item[{double}]{m,  }\item[{double}]{mdot,  }\item[{double}]{freqmin,  }\item[{double}]{freqmax,  }\item[{int}]{ioniz\+\_\+or\+\_\+final,  }\item[{double $\ast$}]{ftot }\end{DoxyParamCaption})}



calculates the total luminosity and the luminosity between freqqmin and freqmax of the disk. More importantly divides the disk into annulae such that each annulus contributes and equal amount to the lumionosity of the disk (within the frequency limits). Thus initializes the structure \char`\"{}disk\char`\"{}. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em double} & rmin The minimum radius of the disk \\
\hline
\mbox{\tt in}  & {\em double} & rmax The maximum radius of the disk \\
\hline
\mbox{\tt in}  & {\em double} & m mass of central object \\
\hline
\mbox{\tt in}  & {\em double} & mdot mass accretion rate \\
\hline
\mbox{\tt in}  & {\em double} & freqmin The minimum frequency \\
\hline
\mbox{\tt in}  & {\em double} & freqmax The maximum frequency \\
\hline
\mbox{\tt in}  & {\em int} & ioniz\+\_\+or\+\_\+final A flag indicating whether this is an ionization or a detailed spectral cycle (used to determine the spectral type to use) \\
\hline
\mbox{\tt out}  & {\em double} & $\ast$ ftot The band limited luminosity in the freqency interval \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the total luminosity of the disk
\end{DoxyReturn}
This routine assumes the temperature distribution for the disk is that of a simple Shakura-\/\+Sunyaev disk, and uses this to determine the band limited luminosity of the disk. Additionally, it divides the disk in the rings of the same band-\/limited luminosity, so that equal numbers of photons can be generated from each ring. (The reason the disk has to be initilaized mulitple times is because the rings are different for different freqency intervals.)

\paragraph*{Notes}

The information needed to generate photons from the disk is stored in the disk structure. The positional parameters x and v are at the edge of the ring, but many of the other parameters (like temperature) are at the mid point. 

Definition at line 842 of file photon\+\_\+gen.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c_a3c3ee1b7657b6c1bc4e6c1e6d8300020_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c_a3c3ee1b7657b6c1bc4e6c1e6d8300020_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{photon__gen_8c_a07c7b56c161732c7397e69c4ff4bdb31}\label{photon__gen_8c_a07c7b56c161732c7397e69c4ff4bdb31}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!phot\+\_\+gen\+\_\+sum@{phot\+\_\+gen\+\_\+sum}}
\index{phot\+\_\+gen\+\_\+sum@{phot\+\_\+gen\+\_\+sum}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{phot\+\_\+gen\+\_\+sum()}{phot\_gen\_sum()}}
{\footnotesize\ttfamily int phot\+\_\+gen\+\_\+sum (\begin{DoxyParamCaption}\item[{filename}]{,  }\item[{mode}]{ }\end{DoxyParamCaption})}



write information about the disk to a file 


\begin{DoxyParams}{Parameters}
{\em \mbox{[}in} & out\mbox{]} char filename\mbox{[}\mbox{]} The name of the file \\
\hline
{\em \mbox{[}in} & out\mbox{]} char mode\mbox{[}\mbox{]} A switch to determine whther to write a new file or append to an existing file \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
The routine normal writes the disk.\+diag file. It provides infomration not only about the rings used, but also about the number of photons that hit each ring,

\paragraph*{Notes}

This routine is now well-\/named 

Definition at line 1181 of file photon\+\_\+gen.\+c.

\mbox{\Hypertarget{photon__gen_8c_ac6e59fd8ed9979322e86a14ed34c2851}\label{photon__gen_8c_ac6e59fd8ed9979322e86a14ed34c2851}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!photo\+\_\+gen\+\_\+disk@{photo\+\_\+gen\+\_\+disk}}
\index{photo\+\_\+gen\+\_\+disk@{photo\+\_\+gen\+\_\+disk}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{photo\+\_\+gen\+\_\+disk()}{photo\_gen\_disk()}}
{\footnotesize\ttfamily int photo\+\_\+gen\+\_\+disk (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{double}]{weight,  }\item[{double}]{f1,  }\item[{double}]{f2,  }\item[{int}]{spectype,  }\item[{int}]{istart,  }\item[{int}]{nphot }\end{DoxyParamCaption})}



Generate disk photons. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em Phot\+Ptr} & p The entire photon structure \\
\hline
\mbox{\tt in}  & {\em double} & weight The weight of photons to generate \\
\hline
\mbox{\tt in}  & {\em double} & f1 The minimum frequency \\
\hline
\mbox{\tt in}  & {\em double} & f2 The maxnimum frequency \\
\hline
\mbox{\tt in}  & {\em int} & spectype The spectrum type to generate\+: 0 is bb \\
\hline
\mbox{\tt in}  & {\em int} & istart The starting point in p for generating photons \\
\hline
\mbox{\tt in}  & {\em int} & nphot The number of photons to generate \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
\paragraph*{Notes}

Definition at line 1019 of file photon\+\_\+gen.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c_ac6e59fd8ed9979322e86a14ed34c2851_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=334pt]{photon__gen_8c_ac6e59fd8ed9979322e86a14ed34c2851_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{photon__gen_8c_a19e1b27b1fe040ccadcd39a5783c4d60}\label{photon__gen_8c_a19e1b27b1fe040ccadcd39a5783c4d60}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!photo\+\_\+gen\+\_\+star@{photo\+\_\+gen\+\_\+star}}
\index{photo\+\_\+gen\+\_\+star@{photo\+\_\+gen\+\_\+star}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{photo\+\_\+gen\+\_\+star()}{photo\_gen\_star()}}
{\footnotesize\ttfamily int photo\+\_\+gen\+\_\+star (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{double}]{r,  }\item[{double}]{t,  }\item[{double}]{weight,  }\item[{double}]{f1,  }\item[{double}]{f2,  }\item[{int}]{spectype,  }\item[{int}]{istart,  }\item[{int}]{nphot }\end{DoxyParamCaption})}



Generate nphot photons from the star in the frequency interval f1 to f2. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em Phot\+Ptr} & p The entire photon structure \\
\hline
\mbox{\tt in}  & {\em double} & r The radiius at which to generate photons \\
\hline
\mbox{\tt in}  & {\em double} & t The effective temperature of the stat \\
\hline
\mbox{\tt in}  & {\em double} & weight The weight of photons to generate \\
\hline
\mbox{\tt in}  & {\em double} & f1 The minimum frequencey \\
\hline
\mbox{\tt in}  & {\em double} & f2 The maximum frequencey \\
\hline
\mbox{\tt in}  & {\em int} & spectype The type of spectrum (bb or spectral model) to use in generating photons \\
\hline
\mbox{\tt in}  & {\em int} & istart The positions in the photon structure where the first photons will be stored \\
\hline
\mbox{\tt in}  & {\em int} & nphot The nubmer of photons to generate \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
The routine generates photons emergying from a sphere. It uses randvcos to determine the direction of the photon.

\paragraph*{Notes}

This routine is also used in generating photons from a boundary layer

The routine allows for the possibility that part of the star will be covered by a vertically extended disk and avoids generating photons there. 

Definition at line 722 of file photon\+\_\+gen.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c_a19e1b27b1fe040ccadcd39a5783c4d60_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=334pt]{photon__gen_8c_a19e1b27b1fe040ccadcd39a5783c4d60_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{photon__gen_8c_a663f46d36d6962c7993e4c002442c23b}\label{photon__gen_8c_a663f46d36d6962c7993e4c002442c23b}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!photon\+\_\+checks@{photon\+\_\+checks}}
\index{photon\+\_\+checks@{photon\+\_\+checks}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{photon\+\_\+checks()}{photon\_checks()}}
{\footnotesize\ttfamily int photon\+\_\+checks (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{double}]{freqmin,  }\item[{double}]{freqmax,  }\item[{char $\ast$}]{comment }\end{DoxyParamCaption})}



Perform some simple checks on the photon distribution just produced. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Phot\+Ptr} & p The photon structure \\
\hline
\mbox{\tt in}  & {\em double} & freqmin The minimum fequency that was used to generate the photons \\
\hline
\mbox{\tt in}  & {\em double} & freqmax The maximum fequency that was used to generate the photons \\
\hline
\mbox{\tt in}  & {\em char} & $\ast$ comment A comment that accompanies this particular call \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
The routine checks photons to see if they are \char`\"{}reasonable\char`\"{}. The checks mostly have to do with the frequency of the photons. The program will exit is too many photons fail the checks

\paragraph*{Notes}

\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000046}{Bug}]The routine also a few numbers that summarize some aspects of the the distribution. Some of these have to do with the Ferland definition of IP, which we are discussing deleting\end{DoxyRefDesc}


Definition at line 1286 of file photon\+\_\+gen.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c_a663f46d36d6962c7993e4c002442c23b_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=265pt]{photon__gen_8c_a663f46d36d6962c7993e4c002442c23b_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{photon__gen_8c_addfbba966a4d69bdc71b771e0d7f3cdf}\label{photon__gen_8c_addfbba966a4d69bdc71b771e0d7f3cdf}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!populate\+\_\+bands@{populate\+\_\+bands}}
\index{populate\+\_\+bands@{populate\+\_\+bands}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{populate\+\_\+bands()}{populate\_bands()}}
{\footnotesize\ttfamily double populate\+\_\+bands (\begin{DoxyParamCaption}\item[{double}]{f1,  }\item[{double}]{f2,  }\item[{int}]{ioniz\+\_\+or\+\_\+final,  }\item[{int}]{iwind,  }\item[{struct \hyperlink{structxbands}{xbands} $\ast$}]{band }\end{DoxyParamCaption})}



Determine how many photons to allocate to each band. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em double} & f1 A minimum frequency (N\+OT U\+S\+ED) \\
\hline
\mbox{\tt in}  & {\em double} & f2 A maximum frequency (N\+OT U\+S\+ED) \\
\hline
\mbox{\tt in}  & {\em int} & ioniz\+\_\+or\+\_\+final indicate whether this is for an ioniz\+\_\+or\+\_\+final \\
\hline
\mbox{\tt in}  & {\em int} & iwind indicates where wind photons are created \\
\hline
\mbox{\tt in,out}  & {\em struct} & xbands $\ast$ band is a pointer to the band sturctue where everythin is \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
ftot which is the sum of the band limited luminosities
\end{DoxyReturn}
This routine determines how many photons to allocate to each band. Inputs determine a minimum fraction to allocate to each band, but these need not sum to 1, and so the rest of the photons are allocated naturally (that is to say) by the luminosities within the bands.

Much of the actual work is carried out in xdefine\+\_\+phot.

\paragraph*{Notes}

\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000044}{Bug}]f1 and f2 do not appear to be used and should be removed from the call.\end{DoxyRefDesc}


Definition at line 188 of file photon\+\_\+gen.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c_addfbba966a4d69bdc71b771e0d7f3cdf_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=242pt]{photon__gen_8c_addfbba966a4d69bdc71b771e0d7f3cdf_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{photon__gen_8c_a0bc15d347d507f21da65e37f659de349}\label{photon__gen_8c_a0bc15d347d507f21da65e37f659de349}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!star\+\_\+init@{star\+\_\+init}}
\index{star\+\_\+init@{star\+\_\+init}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{star\+\_\+init()}{star\_init()}}
{\footnotesize\ttfamily int star\+\_\+init (\begin{DoxyParamCaption}\item[{double}]{freqmin,  }\item[{double}]{freqmax,  }\item[{int}]{ioniz\+\_\+or\+\_\+final,  }\item[{double $\ast$}]{f }\end{DoxyParamCaption})}



(r, tstar, freqmin, freqmax, ioniz\+\_\+or\+\_\+final, f) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em double} & freqmin The minimum freqency for the band \\
\hline
\mbox{\tt in}  & {\em double} & freqmax The maximum freqency for the band \\
\hline
 & {\em \mbox{[}in} & out\mbox{]} int ioniz\+\_\+or\+\_\+final A flag indicating whether this is for an ionization cycle or a detailed spectrum cycle \\
\hline
\mbox{\tt out}  & {\em double} & $\ast$ f The baand limited luminosity of the star \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
This routine calculates the luminosity of the star and the luminosity within the frequency boundaries.

\paragraph*{Notes}

The routine allows for backscattering of light onto the star assuming the user has opted to include this in the determination of the effective temperature of the star 

Definition at line 648 of file photon\+\_\+gen.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c_a0bc15d347d507f21da65e37f659de349_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c_a0bc15d347d507f21da65e37f659de349_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{photon__gen_8c_a9a0acf2d461c665dc0302defa95ded65}\label{photon__gen_8c_a9a0acf2d461c665dc0302defa95ded65}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!xdefine\+\_\+phot@{xdefine\+\_\+phot}}
\index{xdefine\+\_\+phot@{xdefine\+\_\+phot}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{xdefine\+\_\+phot()}{xdefine\_phot()}}
{\footnotesize\ttfamily int xdefine\+\_\+phot (\begin{DoxyParamCaption}\item[{double}]{f1,  }\item[{double}]{f2,  }\item[{int}]{ioniz\+\_\+or\+\_\+final,  }\item[{int}]{iwind }\end{DoxyParamCaption})}



calculates the band limited fluxes \& luminosities, and prepares for the producting of photons (by reinitializing the disk, among other things). 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em double} & f1 The minimum freqeuncy \\
\hline
\mbox{\tt in}  & {\em double} & f2 The maximum frequency \\
\hline
\mbox{\tt in}  & {\em int} & ioniz\+\_\+or\+\_\+final 0 -\/$>$ this is for the wind ionization calculation; 1-\/$>$ it is for the final spectrum calculation \\
\hline
\mbox{\tt in}  & {\em int} & iwind if 0, include wind photons; if 1 include wind photons and force a recalcuation of ion denisities, if -\/1, ignore the possibility of wind photons \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
This is a routine that initilizes things. It does not generate photons itself.

The routine calls various other routines to calcuate the band limited luminosities of various radiation sources (which is used in allocating how many photons to create from each). The results are stored in elements of the geo structure.

\paragraph*{Notes}

Note\+: This routine is something of a kluge. Information is passed back to the calling routine through the geo structure, rather than a more obvious method. The routine was created when a banded approach was defined, but the whole section might be more obvious. 

Definition at line 286 of file photon\+\_\+gen.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{photon__gen_8c_a9a0acf2d461c665dc0302defa95ded65_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=337pt]{photon__gen_8c_a9a0acf2d461c665dc0302defa95ded65_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{photon__gen_8c_ab7f1c9362f29a0b44f41cff21494b6df}\label{photon__gen_8c_ab7f1c9362f29a0b44f41cff21494b6df}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!xmake\+\_\+phot@{xmake\+\_\+phot}}
\index{xmake\+\_\+phot@{xmake\+\_\+phot}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{xmake\+\_\+phot()}{xmake\_phot()}}
{\footnotesize\ttfamily int xmake\+\_\+phot (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{double}]{f1,  }\item[{double}]{f2,  }\item[{int}]{ioniz\+\_\+or\+\_\+final,  }\item[{int}]{iwind,  }\item[{double}]{weight,  }\item[{int}]{iphot\+\_\+start,  }\item[{int}]{nphotons }\end{DoxyParamCaption})}



just makes photons 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em Phot\+Ptr} & p The entire photon structure \\
\hline
\mbox{\tt in}  & {\em double} & f1 The minimum frequency for generating photons \\
\hline
\mbox{\tt in}  & {\em double} & f2 The maximum frequency for generating photons \\
\hline
\mbox{\tt in}  & {\em int} & ioniz\+\_\+or\+\_\+final A flag indicating whether this if for an ionization or detailed spectral cycle (Used to determine what underlying spectrum, e.\+g bb or detailed models) to sample \\
\hline
\mbox{\tt in}  & {\em int} & iwind A flag indicating whether or not to genrate any wind photons. \\
\hline
\mbox{\tt in}  & {\em double} & weight The weight of photons to generate \\
\hline
\mbox{\tt in}  & {\em int} & iphot\+\_\+start The position in the photon structure to start storing photons \\
\hline
\mbox{\tt in}  & {\em int} & nphotons The number of photons to generate \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
make\+\_\+phot controls the actual generation of photons. All of the initializations should have been done previously (xdefine\+\_\+phot). xmake\+\_\+phot cycles throght the various possible sources of the wind, including for example, the disk, the central object, and the wind, and creates photons for each, using the ratio of the band limited luminosites to the total band limited luminosity to determine how many photons to select from each source.

\paragraph*{Notes}

Definition at line 422 of file photon\+\_\+gen.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{photon__gen_8c_ab7f1c9362f29a0b44f41cff21494b6df_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=229pt]{photon__gen_8c_ab7f1c9362f29a0b44f41cff21494b6df_icgraph}
\end{center}
\end{figure}


\subsection{Variable Documentation}
\mbox{\Hypertarget{photon__gen_8c_ab21ea56600a6e1eb09e89816449e09f9}\label{photon__gen_8c_ab21ea56600a6e1eb09e89816449e09f9}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!f1\+\_\+old@{f1\+\_\+old}}
\index{f1\+\_\+old@{f1\+\_\+old}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{f1\+\_\+old}{f1\_old}}
{\footnotesize\ttfamily double f1\+\_\+old = 0}



Definition at line 24 of file photon\+\_\+gen.\+c.

\mbox{\Hypertarget{photon__gen_8c_a40d422c86ec453018368d16aa7c079cd}\label{photon__gen_8c_a40d422c86ec453018368d16aa7c079cd}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!f2\+\_\+old@{f2\+\_\+old}}
\index{f2\+\_\+old@{f2\+\_\+old}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{f2\+\_\+old}{f2\_old}}
{\footnotesize\ttfamily double f2\+\_\+old = 0}



Definition at line 25 of file photon\+\_\+gen.\+c.

\mbox{\Hypertarget{photon__gen_8c_aa454ec9a17879579643258a3855270c3}\label{photon__gen_8c_aa454ec9a17879579643258a3855270c3}} 
\index{photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}!iwind\+\_\+old@{iwind\+\_\+old}}
\index{iwind\+\_\+old@{iwind\+\_\+old}!photon\+\_\+gen.\+c@{photon\+\_\+gen.\+c}}
\subsubsection{\texorpdfstring{iwind\+\_\+old}{iwind\_old}}
{\footnotesize\ttfamily int iwind\+\_\+old = 0}



Definition at line 26 of file photon\+\_\+gen.\+c.

