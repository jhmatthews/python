\hypertarget{reverb_8c}{}\section{/\+Users/mhewitt/python/source/reverb.c File Reference}
\label{reverb_8c}\index{/\+Users/mhewitt/python/source/reverb.\+c@{/\+Users/mhewitt/python/source/reverb.\+c}}


Reverberation mapping functions.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include $<$errno.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atomic.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}python.\+h\char`\"{}}\newline
Include dependency graph for reverb.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{reverb_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
double \hyperlink{reverb_8c_aa5efed3848af045bb3035fc6db93e757}{delay\+\_\+to\+\_\+observer} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} pp)
\begin{DoxyCompactList}\small\item\em Calculates the delay to the observer plane. \end{DoxyCompactList}\item 
int \hyperlink{reverb_8c_aed071173676fa884b0045139793c85d7}{delay\+\_\+dump\+\_\+prep} (int restart\+\_\+stat)
\begin{DoxyCompactList}\small\item\em Prepares delay dump output file. \end{DoxyCompactList}\item 
int \hyperlink{reverb_8c_a835e66c48118aa52e1903512ed676f20}{delay\+\_\+dump\+\_\+finish} (void)
\begin{DoxyCompactList}\small\item\em Finishes dumping tracked photons to file. \end{DoxyCompactList}\item 
int \hyperlink{reverb_8c_a83531c4a215b42e705cd97b00088be71}{delay\+\_\+dump\+\_\+combine} (int i\+\_\+ranks)
\begin{DoxyCompactList}\small\item\em Prepares delay dump output file. \end{DoxyCompactList}\item 
int \hyperlink{reverb_8c_ac0ede87d97addcd4c5df57e2930dbdb6}{delay\+\_\+dump} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, int np)
\begin{DoxyCompactList}\small\item\em Dumps tracked photons to file. \end{DoxyCompactList}\item 
int \hyperlink{reverb_8c_a30c0a9051caebba27b5ef5583d38ad0c}{delay\+\_\+dump\+\_\+single} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} pp, int i\+\_\+spec)
\begin{DoxyCompactList}\small\item\em Preps a single photon to be dumped. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
char \hyperlink{reverb_8c_a55ca7fab98bba495ce75d100d6e90d4c}{delay\+\_\+dump\+\_\+file} \mbox{[}\hyperlink{xlog_8c_a10e8c7b8458375c3dbfbb4010a2aba8c}{L\+I\+N\+E\+L\+E\+N\+G\+TH}\mbox{]}
\item 
int \hyperlink{reverb_8c_a588f4feb9a791e95c422851e3806239e}{delay\+\_\+dump\+\_\+bank\+\_\+size} = 65535
\item 
int \hyperlink{reverb_8c_a43dc90d8db821aedbbdb98368d4e1000}{delay\+\_\+dump\+\_\+bank\+\_\+curr} = 0
\item 
int $\ast$ \hyperlink{reverb_8c_ac4656ec5b05a4c9cd89509459fd8243e}{delay\+\_\+dump\+\_\+spec}
\item 
\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} \hyperlink{reverb_8c_a7bfc559baf9a00e484c273ebef3e387f}{delay\+\_\+dump\+\_\+bank}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Reverberation mapping functions. 

\begin{DoxyAuthor}{Author}
S\+WM 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
July, 2015 File containing reverberation mapping functions. 
\end{DoxyDate}


\subsection{Function Documentation}
\mbox{\Hypertarget{reverb_8c_ac0ede87d97addcd4c5df57e2930dbdb6}\label{reverb_8c_ac0ede87d97addcd4c5df57e2930dbdb6}} 
\index{reverb.\+c@{reverb.\+c}!delay\+\_\+dump@{delay\+\_\+dump}}
\index{delay\+\_\+dump@{delay\+\_\+dump}!reverb.\+c@{reverb.\+c}}
\subsubsection{\texorpdfstring{delay\+\_\+dump()}{delay\_dump()}}
{\footnotesize\ttfamily int delay\+\_\+dump (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{int}]{np }\end{DoxyParamCaption})}



Dumps tracked photons to file. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em np} & Pointer to photon array tp dump \\
\hline
\mbox{\tt in}  & {\em np} & Number photons in p \\
\hline
\mbox{\tt in}  & {\em i\+Extracted} & Array of extract flags for p \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0
\end{DoxyReturn}
Sifts through the photons in the delay\+\_\+dump file, checking if they\textquotesingle{}ve scattered or were generated in the wind and so contribute to the delay map. Uses the same filters as the spectra\+\_\+create() function for scatters \& angles.

\paragraph*{Notes}

6/15 -\/ Written by S\+WM 

Definition at line 212 of file reverb.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{reverb_8c_ac0ede87d97addcd4c5df57e2930dbdb6_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=254pt]{reverb_8c_ac0ede87d97addcd4c5df57e2930dbdb6_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{reverb_8c_a83531c4a215b42e705cd97b00088be71}\label{reverb_8c_a83531c4a215b42e705cd97b00088be71}} 
\index{reverb.\+c@{reverb.\+c}!delay\+\_\+dump\+\_\+combine@{delay\+\_\+dump\+\_\+combine}}
\index{delay\+\_\+dump\+\_\+combine@{delay\+\_\+dump\+\_\+combine}!reverb.\+c@{reverb.\+c}}
\subsubsection{\texorpdfstring{delay\+\_\+dump\+\_\+combine()}{delay\_dump\_combine()}}
{\footnotesize\ttfamily int delay\+\_\+dump\+\_\+combine (\begin{DoxyParamCaption}\item[{int}]{i\+\_\+ranks }\end{DoxyParamCaption})}



Prepares delay dump output file. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em i\+\_\+ranks} & Number of parallel processes \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0
\end{DoxyReturn}
Collects all the delay dump files together at the end. Called by the master thread. Uses \textquotesingle{}cat\textquotesingle{} for simplicity.

\paragraph*{Notes}

6/15 -\/ Written by S\+WM 

Definition at line 159 of file reverb.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{reverb_8c_a83531c4a215b42e705cd97b00088be71_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=270pt]{reverb_8c_a83531c4a215b42e705cd97b00088be71_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{reverb_8c_a835e66c48118aa52e1903512ed676f20}\label{reverb_8c_a835e66c48118aa52e1903512ed676f20}} 
\index{reverb.\+c@{reverb.\+c}!delay\+\_\+dump\+\_\+finish@{delay\+\_\+dump\+\_\+finish}}
\index{delay\+\_\+dump\+\_\+finish@{delay\+\_\+dump\+\_\+finish}!reverb.\+c@{reverb.\+c}}
\subsubsection{\texorpdfstring{delay\+\_\+dump\+\_\+finish()}{delay\_dump\_finish()}}
{\footnotesize\ttfamily int delay\+\_\+dump\+\_\+finish (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Finishes dumping tracked photons to file. 

\begin{DoxyReturn}{Returns}
0
\end{DoxyReturn}
Dumps the remaining tracked photons to file, frees memory.

\paragraph*{Notes}

6/15 -\/ Written by S\+WM 

Definition at line 133 of file reverb.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{reverb_8c_a835e66c48118aa52e1903512ed676f20_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=259pt]{reverb_8c_a835e66c48118aa52e1903512ed676f20_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{reverb_8c_aed071173676fa884b0045139793c85d7}\label{reverb_8c_aed071173676fa884b0045139793c85d7}} 
\index{reverb.\+c@{reverb.\+c}!delay\+\_\+dump\+\_\+prep@{delay\+\_\+dump\+\_\+prep}}
\index{delay\+\_\+dump\+\_\+prep@{delay\+\_\+dump\+\_\+prep}!reverb.\+c@{reverb.\+c}}
\subsubsection{\texorpdfstring{delay\+\_\+dump\+\_\+prep()}{delay\_dump\_prep()}}
{\footnotesize\ttfamily int delay\+\_\+dump\+\_\+prep (\begin{DoxyParamCaption}\item[{int}]{restart\+\_\+stat }\end{DoxyParamCaption})}



Prepares delay dump output file. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em filename} & File root for run \\
\hline
\mbox{\tt in}  & {\em restart\+\_\+stat} & If this is a restart run \\
\hline
\mbox{\tt in}  & {\em i\+\_\+rank} & Parallel rank \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0
\end{DoxyReturn}
Sets up filenames, allocates bank for temporary storage of photons that are to be dumped, and if it\textquotesingle{}s not a resume run prints out a header for the file. Filename is set per thread. The file is then built up in batches using \hyperlink{reverb_8c_ac0ede87d97addcd4c5df57e2930dbdb6}{delay\+\_\+dump()} in increments of \hyperlink{reverb_8c_a588f4feb9a791e95c422851e3806239e}{delay\+\_\+dump\+\_\+bank\+\_\+size}.

\paragraph*{Notes}

9/14 -\/ Written by S\+WM 

Definition at line 68 of file reverb.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{reverb_8c_aed071173676fa884b0045139793c85d7_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=275pt]{reverb_8c_aed071173676fa884b0045139793c85d7_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{reverb_8c_a30c0a9051caebba27b5ef5583d38ad0c}\label{reverb_8c_a30c0a9051caebba27b5ef5583d38ad0c}} 
\index{reverb.\+c@{reverb.\+c}!delay\+\_\+dump\+\_\+single@{delay\+\_\+dump\+\_\+single}}
\index{delay\+\_\+dump\+\_\+single@{delay\+\_\+dump\+\_\+single}!reverb.\+c@{reverb.\+c}}
\subsubsection{\texorpdfstring{delay\+\_\+dump\+\_\+single()}{delay\_dump\_single()}}
{\footnotesize\ttfamily int delay\+\_\+dump\+\_\+single (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{pp,  }\item[{int}]{i\+\_\+spec }\end{DoxyParamCaption})}



Preps a single photon to be dumped. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em pp} & Pointer to extracted photon \\
\hline
\mbox{\tt in}  & {\em i\+\_\+spec} & Spectrum p extracted to \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0
\end{DoxyReturn}
Takes a photon and copies it to the staging arrays for delay dumping, to be output to file later.

\paragraph*{Notes}

6/15 -\/ Written by S\+WM 

Definition at line 281 of file reverb.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{reverb_8c_a30c0a9051caebba27b5ef5583d38ad0c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{reverb_8c_a30c0a9051caebba27b5ef5583d38ad0c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{reverb_8c_aa5efed3848af045bb3035fc6db93e757}\label{reverb_8c_aa5efed3848af045bb3035fc6db93e757}} 
\index{reverb.\+c@{reverb.\+c}!delay\+\_\+to\+\_\+observer@{delay\+\_\+to\+\_\+observer}}
\index{delay\+\_\+to\+\_\+observer@{delay\+\_\+to\+\_\+observer}!reverb.\+c@{reverb.\+c}}
\subsubsection{\texorpdfstring{delay\+\_\+to\+\_\+observer()}{delay\_to\_observer()}}
{\footnotesize\ttfamily double delay\+\_\+to\+\_\+observer (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{pp }\end{DoxyParamCaption})}



Calculates the delay to the observer plane. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em pp} & Pointer to test photon \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Distance from photon to plane
\end{DoxyReturn}
Sets up the observer plane, then calculates the distance from the current photon to it. Uses \hyperlink{foo_8h_ae443765b508c1d69ac5249ef9de2bb81}{ds\+\_\+to\+\_\+plane()} for reliability.

\paragraph*{Notes}

9/14 -\/ Written by S\+WM 

Definition at line 37 of file reverb.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=251pt]{reverb_8c_aa5efed3848af045bb3035fc6db93e757_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{reverb_8c_aa5efed3848af045bb3035fc6db93e757_icgraph}
\end{center}
\end{figure}


\subsection{Variable Documentation}
\mbox{\Hypertarget{reverb_8c_a7bfc559baf9a00e484c273ebef3e387f}\label{reverb_8c_a7bfc559baf9a00e484c273ebef3e387f}} 
\index{reverb.\+c@{reverb.\+c}!delay\+\_\+dump\+\_\+bank@{delay\+\_\+dump\+\_\+bank}}
\index{delay\+\_\+dump\+\_\+bank@{delay\+\_\+dump\+\_\+bank}!reverb.\+c@{reverb.\+c}}
\subsubsection{\texorpdfstring{delay\+\_\+dump\+\_\+bank}{delay\_dump\_bank}}
{\footnotesize\ttfamily \hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} delay\+\_\+dump\+\_\+bank}



Definition at line 20 of file reverb.\+c.

\mbox{\Hypertarget{reverb_8c_a43dc90d8db821aedbbdb98368d4e1000}\label{reverb_8c_a43dc90d8db821aedbbdb98368d4e1000}} 
\index{reverb.\+c@{reverb.\+c}!delay\+\_\+dump\+\_\+bank\+\_\+curr@{delay\+\_\+dump\+\_\+bank\+\_\+curr}}
\index{delay\+\_\+dump\+\_\+bank\+\_\+curr@{delay\+\_\+dump\+\_\+bank\+\_\+curr}!reverb.\+c@{reverb.\+c}}
\subsubsection{\texorpdfstring{delay\+\_\+dump\+\_\+bank\+\_\+curr}{delay\_dump\_bank\_curr}}
{\footnotesize\ttfamily int delay\+\_\+dump\+\_\+bank\+\_\+curr = 0}



Definition at line 18 of file reverb.\+c.

\mbox{\Hypertarget{reverb_8c_a588f4feb9a791e95c422851e3806239e}\label{reverb_8c_a588f4feb9a791e95c422851e3806239e}} 
\index{reverb.\+c@{reverb.\+c}!delay\+\_\+dump\+\_\+bank\+\_\+size@{delay\+\_\+dump\+\_\+bank\+\_\+size}}
\index{delay\+\_\+dump\+\_\+bank\+\_\+size@{delay\+\_\+dump\+\_\+bank\+\_\+size}!reverb.\+c@{reverb.\+c}}
\subsubsection{\texorpdfstring{delay\+\_\+dump\+\_\+bank\+\_\+size}{delay\_dump\_bank\_size}}
{\footnotesize\ttfamily int delay\+\_\+dump\+\_\+bank\+\_\+size = 65535}



Definition at line 18 of file reverb.\+c.

\mbox{\Hypertarget{reverb_8c_a55ca7fab98bba495ce75d100d6e90d4c}\label{reverb_8c_a55ca7fab98bba495ce75d100d6e90d4c}} 
\index{reverb.\+c@{reverb.\+c}!delay\+\_\+dump\+\_\+file@{delay\+\_\+dump\+\_\+file}}
\index{delay\+\_\+dump\+\_\+file@{delay\+\_\+dump\+\_\+file}!reverb.\+c@{reverb.\+c}}
\subsubsection{\texorpdfstring{delay\+\_\+dump\+\_\+file}{delay\_dump\_file}}
{\footnotesize\ttfamily char delay\+\_\+dump\+\_\+file\mbox{[}\hyperlink{xlog_8c_a10e8c7b8458375c3dbfbb4010a2aba8c}{L\+I\+N\+E\+L\+E\+N\+G\+TH}\mbox{]}}



Definition at line 17 of file reverb.\+c.

\mbox{\Hypertarget{reverb_8c_ac4656ec5b05a4c9cd89509459fd8243e}\label{reverb_8c_ac4656ec5b05a4c9cd89509459fd8243e}} 
\index{reverb.\+c@{reverb.\+c}!delay\+\_\+dump\+\_\+spec@{delay\+\_\+dump\+\_\+spec}}
\index{delay\+\_\+dump\+\_\+spec@{delay\+\_\+dump\+\_\+spec}!reverb.\+c@{reverb.\+c}}
\subsubsection{\texorpdfstring{delay\+\_\+dump\+\_\+spec}{delay\_dump\_spec}}
{\footnotesize\ttfamily int$\ast$ delay\+\_\+dump\+\_\+spec}



Definition at line 19 of file reverb.\+c.

