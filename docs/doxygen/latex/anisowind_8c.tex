\hypertarget{anisowind_8c}{}\section{/\+Users/mhewitt/python/source/anisowind.c File Reference}
\label{anisowind_8c}\index{/\+Users/mhewitt/python/source/anisowind.\+c@{/\+Users/mhewitt/python/source/anisowind.\+c}}


Routines to implement anisotropic scattering in the wind.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atomic.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}python.\+h\char`\"{}}\newline
Include dependency graph for anisowind.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{anisowind_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{anisowind_8c_a30e700ca1832f578d922cf82e7a7833a}{T\+A\+U\+\_\+\+T\+OP}
\item 
\#define \hyperlink{anisowind_8c_a32d322486dd5c75bc90a3e069795ca48}{T\+A\+U\+\_\+\+B\+OT}~0.\+01
\item 
\#define \hyperlink{anisowind_8c_a345cd57c7488cd806c3985578255bc5b}{V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+F\+L\+O\+OR}~1e-\/5
\item 
\#define \hyperlink{anisowind_8c_ada627bd85738018041d77e7148607d90}{V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+T\+AU}~11.\+51
\item 
\#define \hyperlink{anisowind_8c_a52124d035a50390906fac4141e93a958}{R\+E\+W\+E\+I\+G\+H\+T\+W\+I\+N\+D\+\_\+\+T\+A\+U\+\_\+\+M\+AX}~100.
\item 
\#define \hyperlink{anisowind_8c_a536ffe4a24745665335aef1c4684090e}{L\+O\+G\+T\+A\+U\+M\+IN}~-\/2.
\item 
\#define \hyperlink{anisowind_8c_a2744c207c1c56b9104d6892a5404d2ca}{L\+O\+G\+T\+A\+U\+M\+AX}~1.
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{anisowind_8c_aa02bd1c515967ac3e1214843158df2f4}{randwind} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, lmn, \hyperlink{disk_8c_afaba31659717b807b58fa7b80c4847a1}{north})
\begin{DoxyCompactList}\small\item\em calculate a new direction for the photon which is being scattered in the wind in the S\+C\+A\+T\+T\+E\+R\+\_\+\+M\+O\+D\+E\+\_\+\+A\+N\+I\+S\+O\+T\+R\+O\+P\+IC scattering mode. \end{DoxyCompactList}\item 
double \hyperlink{anisowind_8c_af170ad39af01fbe3b232230692c2aa5e}{vrandwind} (double \hyperlink{import__cylindrical_8c_a099bc7b5a9501685180c163c1ffb67d0}{x})
\begin{DoxyCompactList}\small\item\em the function that is used to generate the cdf for anisotropic scattering. \end{DoxyCompactList}\item 
double \hyperlink{anisowind_8c_a76f3cece46c92129a1e138a02aac87ca}{reweightwind} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p)
\begin{DoxyCompactList}\small\item\em calculates the weight of a photon in the wind that is forced to scatter along a specific line of sight. \end{DoxyCompactList}\item 
int \hyperlink{anisowind_8c_a62480c3fe99eaa0284c85a48b1e8427d}{make\+\_\+cdf\+\_\+randwind} (double tau)
\item 
int \hyperlink{anisowind_8c_a5cc282e1f3d56ce0f29cb080bc225408}{randwind\+\_\+thermal\+\_\+trapping} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, int $\ast$nnscat)
\begin{DoxyCompactList}\small\item\em is the routine which chooses a new anisotropic direction in geo.\+scatter\+\_\+mode = S\+C\+A\+T\+T\+E\+R\+\_\+\+M\+O\+D\+E\+\_\+\+T\+H\+E\+R\+M\+AL \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{struct_cdf}{Cdf} \hyperlink{anisowind_8c_ab3e97ac75b82f9c4ced9218e78eb2fa4}{cdf\+\_\+randwind\+\_\+store} \mbox{[}100\mbox{]}
\item 
\hyperlink{python_8h_a14b633e617b31ead523c75ce80cc56e1}{Cdf\+Ptr} \hyperlink{anisowind_8c_a7d5d3c2b11592abf6eb482a145e10d50}{cdf\+\_\+randwind}
\item 
struct \hyperlink{structphoton}{photon} \hyperlink{anisowind_8c_a9f5059b178ab31b23b014793eb4854b0}{phot\+\_\+randwind}
\item 
double \hyperlink{anisowind_8c_acabc03109a812245488027702104978c}{tau\+\_\+randwind} = -\/1000.
\item 
int \hyperlink{anisowind_8c_a0ae08e53a25f8ac625b0c2f872056d2d}{reweightwind\+\_\+init} = 1
\item 
double \hyperlink{anisowind_8c_addb96381a70d5bbbd4d70c8b469529d3}{reweightwind\+\_\+zmax}
\item 
int \hyperlink{anisowind_8c_a872ce5174f328e50a8381894469b3790}{init\+\_\+make\+\_\+cdf\+\_\+randwind} = 1
\begin{DoxyCompactList}\small\item\em Generate the cumulative distribution functions needed for selecting a direction for a scattered photon, and then select the cdf needed ro a particulat tau. \end{DoxyCompactList}\item 
int \hyperlink{anisowind_8c_a656c37768c70e0b91e3f5028654f79ec}{make\+\_\+cdf\+\_\+randwind\+\_\+njumps}
\item 
double \hyperlink{anisowind_8c_a6f923c8cdf71897592f32606c6d8fd0e}{make\+\_\+cdf\+\_\+randwind\+\_\+jumps} \mbox{[}180\mbox{]}
\item 
double \hyperlink{anisowind_8c_af5db99077c04b8cf610205694640ddeb}{cdf\+\_\+randwind\+\_\+dlogtau}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Routines to implement anisotropic scattering in the wind. 

\begin{DoxyAuthor}{Author}
ksl 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
March, 2018
\end{DoxyDate}
Python supports several ways to determine a new photon direction when a photon scatters in thie wind. These include


\begin{DoxyItemize}
\item S\+C\+A\+T\+T\+E\+R\+\_\+\+M\+O\+D\+E\+\_\+\+I\+S\+O\+T\+R\+O\+P\+IC -\/isotropic scattering (randvec),
\item S\+C\+A\+T\+T\+E\+R\+\_\+\+M\+O\+D\+E\+\_\+\+A\+N\+I\+S\+O\+T\+R\+O\+P\+IC -\/ anisotropic scattering (randwind) and
\item S\+C\+A\+T\+T\+E\+R\+\_\+\+M\+O\+D\+E\+\_\+\+T\+H\+E\+R\+M\+AL -\/ thermally-\/broadened anisotropic scattering (randwind\+\_\+thermal\+\_\+trapping). 
\end{DoxyItemize}

\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{anisowind_8c_a2744c207c1c56b9104d6892a5404d2ca}\label{anisowind_8c_a2744c207c1c56b9104d6892a5404d2ca}} 
\index{anisowind.\+c@{anisowind.\+c}!L\+O\+G\+T\+A\+U\+M\+AX@{L\+O\+G\+T\+A\+U\+M\+AX}}
\index{L\+O\+G\+T\+A\+U\+M\+AX@{L\+O\+G\+T\+A\+U\+M\+AX}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{L\+O\+G\+T\+A\+U\+M\+AX}{LOGTAUMAX}}
{\footnotesize\ttfamily \#define L\+O\+G\+T\+A\+U\+M\+AX~1.}



Definition at line 484 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_a536ffe4a24745665335aef1c4684090e}\label{anisowind_8c_a536ffe4a24745665335aef1c4684090e}} 
\index{anisowind.\+c@{anisowind.\+c}!L\+O\+G\+T\+A\+U\+M\+IN@{L\+O\+G\+T\+A\+U\+M\+IN}}
\index{L\+O\+G\+T\+A\+U\+M\+IN@{L\+O\+G\+T\+A\+U\+M\+IN}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{L\+O\+G\+T\+A\+U\+M\+IN}{LOGTAUMIN}}
{\footnotesize\ttfamily \#define L\+O\+G\+T\+A\+U\+M\+IN~-\/2.}



Definition at line 483 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_a52124d035a50390906fac4141e93a958}\label{anisowind_8c_a52124d035a50390906fac4141e93a958}} 
\index{anisowind.\+c@{anisowind.\+c}!R\+E\+W\+E\+I\+G\+H\+T\+W\+I\+N\+D\+\_\+\+T\+A\+U\+\_\+\+M\+AX@{R\+E\+W\+E\+I\+G\+H\+T\+W\+I\+N\+D\+\_\+\+T\+A\+U\+\_\+\+M\+AX}}
\index{R\+E\+W\+E\+I\+G\+H\+T\+W\+I\+N\+D\+\_\+\+T\+A\+U\+\_\+\+M\+AX@{R\+E\+W\+E\+I\+G\+H\+T\+W\+I\+N\+D\+\_\+\+T\+A\+U\+\_\+\+M\+AX}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{R\+E\+W\+E\+I\+G\+H\+T\+W\+I\+N\+D\+\_\+\+T\+A\+U\+\_\+\+M\+AX}{REWEIGHTWIND\_TAU\_MAX}}
{\footnotesize\ttfamily \#define R\+E\+W\+E\+I\+G\+H\+T\+W\+I\+N\+D\+\_\+\+T\+A\+U\+\_\+\+M\+AX~100.}



Definition at line 321 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_a32d322486dd5c75bc90a3e069795ca48}\label{anisowind_8c_a32d322486dd5c75bc90a3e069795ca48}} 
\index{anisowind.\+c@{anisowind.\+c}!T\+A\+U\+\_\+\+B\+OT@{T\+A\+U\+\_\+\+B\+OT}}
\index{T\+A\+U\+\_\+\+B\+OT@{T\+A\+U\+\_\+\+B\+OT}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{T\+A\+U\+\_\+\+B\+OT}{TAU\_BOT}}
{\footnotesize\ttfamily \#define T\+A\+U\+\_\+\+B\+OT~0.\+01}



Definition at line 92 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_a30e700ca1832f578d922cf82e7a7833a}\label{anisowind_8c_a30e700ca1832f578d922cf82e7a7833a}} 
\index{anisowind.\+c@{anisowind.\+c}!T\+A\+U\+\_\+\+T\+OP@{T\+A\+U\+\_\+\+T\+OP}}
\index{T\+A\+U\+\_\+\+T\+OP@{T\+A\+U\+\_\+\+T\+OP}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{T\+A\+U\+\_\+\+T\+OP}{TAU\_TOP}}
{\footnotesize\ttfamily \#define T\+A\+U\+\_\+\+T\+OP}

{\bfseries Value\+:}
\begin{DoxyCode}
10.0         \textcolor{comment}{/* tau above which we assume the angular distribution function}
\textcolor{comment}{                                   no longer changes significantly, e.g above which the surface behaves}
\textcolor{comment}{                                   like a solid surface */}
\end{DoxyCode}


Definition at line 89 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_a345cd57c7488cd806c3985578255bc5b}\label{anisowind_8c_a345cd57c7488cd806c3985578255bc5b}} 
\index{anisowind.\+c@{anisowind.\+c}!V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+F\+L\+O\+OR@{V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+F\+L\+O\+OR}}
\index{V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+F\+L\+O\+OR@{V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+F\+L\+O\+OR}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+F\+L\+O\+OR}{VRANDWIND\_FLOOR}}
{\footnotesize\ttfamily \#define V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+F\+L\+O\+OR~1e-\/5}



Definition at line 253 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_ada627bd85738018041d77e7148607d90}\label{anisowind_8c_ada627bd85738018041d77e7148607d90}} 
\index{anisowind.\+c@{anisowind.\+c}!V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+T\+AU@{V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+T\+AU}}
\index{V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+T\+AU@{V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+T\+AU}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+T\+AU}{VRANDWIND\_TAU}}
{\footnotesize\ttfamily \#define V\+R\+A\+N\+D\+W\+I\+N\+D\+\_\+\+T\+AU~11.\+51}



Definition at line 254 of file anisowind.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{anisowind_8c_a62480c3fe99eaa0284c85a48b1e8427d}\label{anisowind_8c_a62480c3fe99eaa0284c85a48b1e8427d}} 
\index{anisowind.\+c@{anisowind.\+c}!make\+\_\+cdf\+\_\+randwind@{make\+\_\+cdf\+\_\+randwind}}
\index{make\+\_\+cdf\+\_\+randwind@{make\+\_\+cdf\+\_\+randwind}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{make\+\_\+cdf\+\_\+randwind()}{make\_cdf\_randwind()}}
{\footnotesize\ttfamily int make\+\_\+cdf\+\_\+randwind (\begin{DoxyParamCaption}\item[{double}]{tau }\end{DoxyParamCaption})}



Definition at line 489 of file anisowind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{anisowind_8c_a62480c3fe99eaa0284c85a48b1e8427d_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{anisowind_8c_a62480c3fe99eaa0284c85a48b1e8427d_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{anisowind_8c_aa02bd1c515967ac3e1214843158df2f4}\label{anisowind_8c_aa02bd1c515967ac3e1214843158df2f4}} 
\index{anisowind.\+c@{anisowind.\+c}!randwind@{randwind}}
\index{randwind@{randwind}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{randwind()}{randwind()}}
{\footnotesize\ttfamily int randwind (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{lmn}]{,  }\item[{\hyperlink{disk_8c_afaba31659717b807b58fa7b80c4847a1}{north}}]{ }\end{DoxyParamCaption})}



calculate a new direction for the photon which is being scattered in the wind in the S\+C\+A\+T\+T\+E\+R\+\_\+\+M\+O\+D\+E\+\_\+\+A\+N\+I\+S\+O\+T\+R\+O\+P\+IC scattering mode. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Phot\+Ptr} & p The photon (at the position it is scattering, and the resonance causing the scatter indicated) \\
\hline
\mbox{\tt out}  & {\em double} & lmn\mbox{[}3\mbox{]} The new photon direction \\
\hline
\mbox{\tt in}  & {\em double} & north\mbox{[}3\mbox{]} the direction of maximum velocity gradient in the wind cell where the photon is located \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Normally returns 0, -\/1 if nres for the photon is not positive (which would indicate this was not a resonance scatter)
\end{DoxyReturn}
This routine is called whenever one wants to generate a new direction in the S\+C\+A\+T\+T\+E\+R\+\_\+\+M\+O\+D\+E\+\_\+\+A\+N\+I\+S\+O\+T\+R\+O\+P\+IC scattering mode.

Given the photon position and the resonance, the routine $\ast$ first calcuates the optical depth in the direction of the maximum dv\+\_\+ds for that cell.

The routine then calls, make\+\_\+cdf\+\_\+randwind to create a comulative distribution function for scattering of as a function of the angle from the direction of minimum optical depth.

Using this cdf, it randomly selects a direction for the photon.

These calculations are all carried out as if the photon were in the x-\/z plane, because that is where the velocity gradient is defined. As a result one then has to trasform the new photon direction back to the location of the photon

\paragraph*{Notes}

To use a different prescription the only thing that should have to be modified is vrandwind.

It might have been more logical to have transformed the direction of the maximum velcocity gradient to the position of the photon. 

Definition at line 146 of file anisowind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{anisowind_8c_aa02bd1c515967ac3e1214843158df2f4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{anisowind_8c_aa02bd1c515967ac3e1214843158df2f4_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{anisowind_8c_a5cc282e1f3d56ce0f29cb080bc225408}\label{anisowind_8c_a5cc282e1f3d56ce0f29cb080bc225408}} 
\index{anisowind.\+c@{anisowind.\+c}!randwind\+\_\+thermal\+\_\+trapping@{randwind\+\_\+thermal\+\_\+trapping}}
\index{randwind\+\_\+thermal\+\_\+trapping@{randwind\+\_\+thermal\+\_\+trapping}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{randwind\+\_\+thermal\+\_\+trapping()}{randwind\_thermal\_trapping()}}
{\footnotesize\ttfamily int randwind\+\_\+thermal\+\_\+trapping (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{int $\ast$}]{nnscat }\end{DoxyParamCaption})}



is the routine which chooses a new anisotropic direction in geo.\+scatter\+\_\+mode = S\+C\+A\+T\+T\+E\+R\+\_\+\+M\+O\+D\+E\+\_\+\+T\+H\+E\+R\+M\+AL 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em Phot\+Ptr} & p The photon being scattered \\
\hline
\mbox{\tt out}  & {\em int} & $\ast$ nnscat The number of times the phton scattered internally before escaping the local scattering region\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 for success. Also modifies the photon ptr p to reflect new direction (p-\/$>$lmn), and nnscat, which should be copied to the phoiton structure after calling this routine.
\end{DoxyReturn}
This routine uses a rejection method to choose a direction so that the probability distribution of directions generated reflects the probability of escape along each direction in accordance with the sobolev optical depth.

\paragraph*{Notes}

The resonance that caused the scatter must be stored in the photon bundle.

The name of the routine is something of a misnomer. Pure sobolev optical depths are used. The temperature in the cell does not come into the calculation.

Unlike randwind, this routine does not explicitly need to to make a transformation from the xz plane to the location of the photon. This is because dvds is calculated directly using dwind\+\_\+ds 

Definition at line 612 of file anisowind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{anisowind_8c_a5cc282e1f3d56ce0f29cb080bc225408_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{anisowind_8c_a5cc282e1f3d56ce0f29cb080bc225408_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{anisowind_8c_a76f3cece46c92129a1e138a02aac87ca}\label{anisowind_8c_a76f3cece46c92129a1e138a02aac87ca}} 
\index{anisowind.\+c@{anisowind.\+c}!reweightwind@{reweightwind}}
\index{reweightwind@{reweightwind}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{reweightwind()}{reweightwind()}}
{\footnotesize\ttfamily double reweightwind (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p }\end{DoxyParamCaption})}



calculates the weight of a photon in the wind that is forced to scatter along a specific line of sight. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em Phot\+Ptr} & p The photon being scattered \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number corresponding to the reweighting is returned. The revised weight is also stored in p
\end{DoxyReturn}
p must contain the position and N\+EW direction for the photon being scattered. In general, p must also be up to date w. r. t. the number of the resonance that generated the photon.

\paragraph*{Notes}

This routine is called when extracting photons along a specific line of sight.

wmain.\+dv\+\_\+ds, and wmain.\+lmn are maximum value of dvds, and the direction in a cell (that is in the positive xz plane) \begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000001}{Bug}]180414 -\/ ksl -\/ It is not obvious that using D\+F\+U\+D\+GE as the way to choose whether to recalculate the cdf for scatter is correct. One would obtain the wrong answer if the photon moved a small distance and hit a different resonance. \end{DoxyRefDesc}


\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000002}{Bug}]This is a note related to an X\+XX comoment which read as follows\+: Factor of 2 needed because the interval is from -\/1 to 1 X\+XX It\textquotesingle{}s definitely needed to make a uniform distribution work but is this reason really right\end{DoxyRefDesc}


180415 -\/ ksl -\/ My investigation of this indicates that the cdf was generated from -\/1 to 1, and futhermore that cdf\+\_\+gen\+\_\+from\+\_\+function which is used to create the cdf always sets the norm to 1. So it is not clear to me why this is the reweghting. It is also nto clear to me why the reweighting to be less than a factor of 2, which is what if stateement requries. Basically, I do not understand what is going on here at all.

Definition at line 353 of file anisowind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{anisowind_8c_a76f3cece46c92129a1e138a02aac87ca_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{anisowind_8c_a76f3cece46c92129a1e138a02aac87ca_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{anisowind_8c_af170ad39af01fbe3b232230692c2aa5e}\label{anisowind_8c_af170ad39af01fbe3b232230692c2aa5e}} 
\index{anisowind.\+c@{anisowind.\+c}!vrandwind@{vrandwind}}
\index{vrandwind@{vrandwind}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{vrandwind()}{vrandwind()}}
{\footnotesize\ttfamily double vrandwind (\begin{DoxyParamCaption}\item[{double}]{x }\end{DoxyParamCaption})}



the function that is used to generate the cdf for anisotropic scattering. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em double} & x The direction cosine with respect to the direction of tau\+\_\+min\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A number proportional to the probability that a photon will scatter in a direction with a particular direction cosine
\end{DoxyReturn}
The routine calculates a function that is proportional to the probability density. d\+P/dcos(theta) for the photon.

\paragraph*{Notes}

This routine is used by cdf\+\_\+gen\+\_\+from\+\_\+func (via make\+\_\+cdf\+\_\+randwind, when that routine is called from randwind) 

Definition at line 279 of file anisowind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{anisowind_8c_af170ad39af01fbe3b232230692c2aa5e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{anisowind_8c_af170ad39af01fbe3b232230692c2aa5e_icgraph}
\end{center}
\end{figure}


\subsection{Variable Documentation}
\mbox{\Hypertarget{anisowind_8c_a7d5d3c2b11592abf6eb482a145e10d50}\label{anisowind_8c_a7d5d3c2b11592abf6eb482a145e10d50}} 
\index{anisowind.\+c@{anisowind.\+c}!cdf\+\_\+randwind@{cdf\+\_\+randwind}}
\index{cdf\+\_\+randwind@{cdf\+\_\+randwind}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{cdf\+\_\+randwind}{cdf\_randwind}}
{\footnotesize\ttfamily \hyperlink{python_8h_a14b633e617b31ead523c75ce80cc56e1}{Cdf\+Ptr} cdf\+\_\+randwind}



Definition at line 32 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_af5db99077c04b8cf610205694640ddeb}\label{anisowind_8c_af5db99077c04b8cf610205694640ddeb}} 
\index{anisowind.\+c@{anisowind.\+c}!cdf\+\_\+randwind\+\_\+dlogtau@{cdf\+\_\+randwind\+\_\+dlogtau}}
\index{cdf\+\_\+randwind\+\_\+dlogtau@{cdf\+\_\+randwind\+\_\+dlogtau}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{cdf\+\_\+randwind\+\_\+dlogtau}{cdf\_randwind\_dlogtau}}
{\footnotesize\ttfamily double cdf\+\_\+randwind\+\_\+dlogtau}



Definition at line 485 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_ab3e97ac75b82f9c4ced9218e78eb2fa4}\label{anisowind_8c_ab3e97ac75b82f9c4ced9218e78eb2fa4}} 
\index{anisowind.\+c@{anisowind.\+c}!cdf\+\_\+randwind\+\_\+store@{cdf\+\_\+randwind\+\_\+store}}
\index{cdf\+\_\+randwind\+\_\+store@{cdf\+\_\+randwind\+\_\+store}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{cdf\+\_\+randwind\+\_\+store}{cdf\_randwind\_store}}
{\footnotesize\ttfamily struct \hyperlink{struct_cdf}{Cdf} cdf\+\_\+randwind\+\_\+store\mbox{[}100\mbox{]}}



Definition at line 31 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_a872ce5174f328e50a8381894469b3790}\label{anisowind_8c_a872ce5174f328e50a8381894469b3790}} 
\index{anisowind.\+c@{anisowind.\+c}!init\+\_\+make\+\_\+cdf\+\_\+randwind@{init\+\_\+make\+\_\+cdf\+\_\+randwind}}
\index{init\+\_\+make\+\_\+cdf\+\_\+randwind@{init\+\_\+make\+\_\+cdf\+\_\+randwind}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{init\+\_\+make\+\_\+cdf\+\_\+randwind}{init\_make\_cdf\_randwind}}
{\footnotesize\ttfamily int init\+\_\+make\+\_\+cdf\+\_\+randwind = 1}



Generate the cumulative distribution functions needed for selecting a direction for a scattered photon, and then select the cdf needed ro a particulat tau. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em double} & tau The optical depth in the direction of the maximum velocity gradient associated with the scattering event\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
The first time this routine is entered it generates a set of cdfs correspoding to various values of tau which are logrithmically spaced between 0.\+01 and 10. These cddfs are stored in an array of cdf structures

It then selects the closest cdf and sets cdf\+\_\+rand\+\_\+wind to point to this particular cdf

On subsequent calls, the routine merely chooses which cdf is most appropriate for a given tau

\paragraph*{Notes}

The probability densities are calculated in vrandwind

The basic idea of this routine is to calculate a series of cdfs the first time the routine is called that are spaced in a sensible fashion so that one does not have to regenerate the cdfs everytime one wants to calulate the probability a photon will be scattered in certain direction.

On subsequent calls the routine simply chooses which of the cdfs to use by setting cdf\+\_\+randwind to one of the precalculate cdfs. 

Definition at line 480 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_a6f923c8cdf71897592f32606c6d8fd0e}\label{anisowind_8c_a6f923c8cdf71897592f32606c6d8fd0e}} 
\index{anisowind.\+c@{anisowind.\+c}!make\+\_\+cdf\+\_\+randwind\+\_\+jumps@{make\+\_\+cdf\+\_\+randwind\+\_\+jumps}}
\index{make\+\_\+cdf\+\_\+randwind\+\_\+jumps@{make\+\_\+cdf\+\_\+randwind\+\_\+jumps}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{make\+\_\+cdf\+\_\+randwind\+\_\+jumps}{make\_cdf\_randwind\_jumps}}
{\footnotesize\ttfamily double make\+\_\+cdf\+\_\+randwind\+\_\+jumps\mbox{[}180\mbox{]}}



Definition at line 482 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_a656c37768c70e0b91e3f5028654f79ec}\label{anisowind_8c_a656c37768c70e0b91e3f5028654f79ec}} 
\index{anisowind.\+c@{anisowind.\+c}!make\+\_\+cdf\+\_\+randwind\+\_\+njumps@{make\+\_\+cdf\+\_\+randwind\+\_\+njumps}}
\index{make\+\_\+cdf\+\_\+randwind\+\_\+njumps@{make\+\_\+cdf\+\_\+randwind\+\_\+njumps}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{make\+\_\+cdf\+\_\+randwind\+\_\+njumps}{make\_cdf\_randwind\_njumps}}
{\footnotesize\ttfamily int make\+\_\+cdf\+\_\+randwind\+\_\+njumps}



Definition at line 481 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_a9f5059b178ab31b23b014793eb4854b0}\label{anisowind_8c_a9f5059b178ab31b23b014793eb4854b0}} 
\index{anisowind.\+c@{anisowind.\+c}!phot\+\_\+randwind@{phot\+\_\+randwind}}
\index{phot\+\_\+randwind@{phot\+\_\+randwind}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{phot\+\_\+randwind}{phot\_randwind}}
{\footnotesize\ttfamily struct \hyperlink{structphoton}{photon} phot\+\_\+randwind}



Definition at line 33 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_a0ae08e53a25f8ac625b0c2f872056d2d}\label{anisowind_8c_a0ae08e53a25f8ac625b0c2f872056d2d}} 
\index{anisowind.\+c@{anisowind.\+c}!reweightwind\+\_\+init@{reweightwind\+\_\+init}}
\index{reweightwind\+\_\+init@{reweightwind\+\_\+init}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{reweightwind\+\_\+init}{reweightwind\_init}}
{\footnotesize\ttfamily int reweightwind\+\_\+init = 1}



Definition at line 322 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_addb96381a70d5bbbd4d70c8b469529d3}\label{anisowind_8c_addb96381a70d5bbbd4d70c8b469529d3}} 
\index{anisowind.\+c@{anisowind.\+c}!reweightwind\+\_\+zmax@{reweightwind\+\_\+zmax}}
\index{reweightwind\+\_\+zmax@{reweightwind\+\_\+zmax}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{reweightwind\+\_\+zmax}{reweightwind\_zmax}}
{\footnotesize\ttfamily double reweightwind\+\_\+zmax}



Definition at line 323 of file anisowind.\+c.

\mbox{\Hypertarget{anisowind_8c_acabc03109a812245488027702104978c}\label{anisowind_8c_acabc03109a812245488027702104978c}} 
\index{anisowind.\+c@{anisowind.\+c}!tau\+\_\+randwind@{tau\+\_\+randwind}}
\index{tau\+\_\+randwind@{tau\+\_\+randwind}!anisowind.\+c@{anisowind.\+c}}
\subsubsection{\texorpdfstring{tau\+\_\+randwind}{tau\_randwind}}
{\footnotesize\ttfamily double tau\+\_\+randwind = -\/1000.}



Definition at line 95 of file anisowind.\+c.

