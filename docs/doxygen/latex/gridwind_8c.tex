\hypertarget{gridwind_8c}{}\section{/\+Users/mhewitt/python/source/gridwind.c File Reference}
\label{gridwind_8c}\index{/\+Users/mhewitt/python/source/gridwind.\+c@{/\+Users/mhewitt/python/source/gridwind.\+c}}


This file contains routines for allocating space for most of the structures needed by Python. These include Wind and Plasma structures, and if using macro atoms, the various structures rwquired for this. The file also contains a routine that maps grid cells in the wind to those in the Plasma structure, and vice versa.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atomic.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}python.\+h\char`\"{}}\newline
Include dependency graph for gridwind.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{gridwind_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{gridwind_8c_a67af2cd841a922ea1001654449239284}{create\+\_\+maps} (int ichoice)
\begin{DoxyCompactList}\small\item\em Create a map between wind and plasma cells. \end{DoxyCompactList}\item 
int \hyperlink{gridwind_8c_af3449f72ae22aca485dfaa4d2f5ae300}{calloc\+\_\+wind} (int nelem)
\begin{DoxyCompactList}\small\item\em Allocate space for the wind domain. \end{DoxyCompactList}\item 
int \hyperlink{gridwind_8c_a391062d8b219dffc8496bd6fc8128cf6}{calloc\+\_\+plasma} (int nelem)
\begin{DoxyCompactList}\small\item\em Allocate memory for plasmamain, which contains temperature, densities, etc. for cells which are in the wind. \end{DoxyCompactList}\item 
int \hyperlink{gridwind_8c_a74097465c23495e007af69e2c66e8d61}{check\+\_\+plasma} (\hyperlink{python_8h_a13ce7664e071685e1c3eaac3c32d7c8d}{Plasma\+Ptr} \hyperlink{compton_8c_ad65f0d74fe764d3ecae5ec1a89d63f08}{xplasma}, \hyperlink{rdpar_8c_abc6cdcc4db9d9768558d0faa2128c876}{message})
\begin{DoxyCompactList}\small\item\em Check that one is not trying to get information from the dummy Plasma element that is associated with wind elements that are not really in the wind. \end{DoxyCompactList}\item 
int \hyperlink{gridwind_8c_a4b147244ba1a5d54d79a57a8ee665b18}{calloc\+\_\+macro} (int nelem)
\begin{DoxyCompactList}\small\item\em Allocate memory to store information for macro atoms for each Plasma element. \end{DoxyCompactList}\item 
int \hyperlink{gridwind_8c_a43492c595dcd8568e2c14a8496c8fd43}{calloc\+\_\+estimators} (int nelem)
\begin{DoxyCompactList}\small\item\em Dynamically allocate various arrays in macromain. \end{DoxyCompactList}\item 
int \hyperlink{gridwind_8c_a311078e4d3e5530a996283eaf4c0fb19}{calloc\+\_\+dyn\+\_\+plasma} (int nelem)
\begin{DoxyCompactList}\small\item\em This subroutine allocates space for dynamic arrays in the plasma structure. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
This file contains routines for allocating space for most of the structures needed by Python. These include Wind and Plasma structures, and if using macro atoms, the various structures rwquired for this. The file also contains a routine that maps grid cells in the wind to those in the Plasma structure, and vice versa. 

\begin{DoxyAuthor}{Author}
ksl,sss,jm 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
April, 2018
\end{DoxyDate}
The hierachy of stuctures that describe a model in Python are domains (which describe a region of the wind), wmain which contains basic information about the cells in each domain, and plasmamain which contains more detailed information about cells which are actually in the wind.

The cells in wmain are created on a simple grid, often a cylindrical region, but no all of this region may be in the wind, as the case in a binconical flow. To save memory, one usually only creates elements of plasmamain that correspond to wind cells that are actually in the wind.

The Plasma structure includes space for storing all of the information needed to calculate ionization and equilibrium in the two-\/level approximation. However, additional structures are required when operating in macro atom mode. Routines for allocating the structures associated with macroatoms are also included here.

Note that a coniderable effort has been made to minimize the total size of the various structures, and so Plasma\+Main contains a number of variables that are actually pointers to other structures that are allocated dynamically depeding on the atomic data. This is also true in the case of the main macro atom structure Macro\+Main.

Note that some structures are allocated in other portions of the code, e.\+g get\+\_\+atomic\+\_\+data, but all of the structures that are needed to set up the wind are here. 

\subsection{Function Documentation}
\mbox{\Hypertarget{gridwind_8c_a311078e4d3e5530a996283eaf4c0fb19}\label{gridwind_8c_a311078e4d3e5530a996283eaf4c0fb19}} 
\index{gridwind.\+c@{gridwind.\+c}!calloc\+\_\+dyn\+\_\+plasma@{calloc\+\_\+dyn\+\_\+plasma}}
\index{calloc\+\_\+dyn\+\_\+plasma@{calloc\+\_\+dyn\+\_\+plasma}!gridwind.\+c@{gridwind.\+c}}
\subsubsection{\texorpdfstring{calloc\+\_\+dyn\+\_\+plasma()}{calloc\_dyn\_plasma()}}
{\footnotesize\ttfamily int calloc\+\_\+dyn\+\_\+plasma (\begin{DoxyParamCaption}\item[{int}]{nelem }\end{DoxyParamCaption})}



This subroutine allocates space for dynamic arrays in the plasma structure. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em int} & nelem the number of plasma cells (actually N\+P\+L\+A\+S\+M\+A+1) to allow for empty cell \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns 0, unless the memory cannot be allocated in which case the proram exits
\end{DoxyReturn}
This subroutine allocates space for variable length arrays in the plasma structure.

\paragraph*{Notes}

Arrays sized to the number of ions are largest, and dominate the size of nplasma, so these were first to be dynamically allocated. 

Definition at line 570 of file gridwind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{gridwind_8c_a311078e4d3e5530a996283eaf4c0fb19_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=322pt]{gridwind_8c_a311078e4d3e5530a996283eaf4c0fb19_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{gridwind_8c_a43492c595dcd8568e2c14a8496c8fd43}\label{gridwind_8c_a43492c595dcd8568e2c14a8496c8fd43}} 
\index{gridwind.\+c@{gridwind.\+c}!calloc\+\_\+estimators@{calloc\+\_\+estimators}}
\index{calloc\+\_\+estimators@{calloc\+\_\+estimators}!gridwind.\+c@{gridwind.\+c}}
\subsubsection{\texorpdfstring{calloc\+\_\+estimators()}{calloc\_estimators()}}
{\footnotesize\ttfamily int calloc\+\_\+estimators (\begin{DoxyParamCaption}\item[{int}]{nelem }\end{DoxyParamCaption})}



Dynamically allocate various arrays in macromain. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em int} & nelem The number of elements in macromain \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns 0, unless the desired memory cannot be allocated in which the routine exits after an error message
\end{DoxyReturn}
To minimize the total amount of memory required by Python in macromode, allocate memory for various arrays in macromain which depend upon the number of ions which are treated as macro atoms

\paragraph*{Notes}

Definition at line 388 of file gridwind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{gridwind_8c_a43492c595dcd8568e2c14a8496c8fd43_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=316pt]{gridwind_8c_a43492c595dcd8568e2c14a8496c8fd43_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{gridwind_8c_a4b147244ba1a5d54d79a57a8ee665b18}\label{gridwind_8c_a4b147244ba1a5d54d79a57a8ee665b18}} 
\index{gridwind.\+c@{gridwind.\+c}!calloc\+\_\+macro@{calloc\+\_\+macro}}
\index{calloc\+\_\+macro@{calloc\+\_\+macro}!gridwind.\+c@{gridwind.\+c}}
\subsubsection{\texorpdfstring{calloc\+\_\+macro()}{calloc\_macro()}}
{\footnotesize\ttfamily int calloc\+\_\+macro (\begin{DoxyParamCaption}\item[{int}]{nelem }\end{DoxyParamCaption})}



Allocate memory to store information for macro atoms for each Plasma element. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em int} & nelem The number of cells that are actually included in the wind. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0, unless memory cannot allocate the requested memory in which case the program exits
\end{DoxyReturn}
This routine allocates memory for the structure macromain, in the situation where the program is being run in macro-\/atom mode.

\paragraph*{Notes}

The size of calloc macro depends on the number cells in the wind, but many of the elements of macro main are simply stucture pointers that are allocated by calloc\+\_\+estimators. 

Definition at line 330 of file gridwind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{gridwind_8c_a4b147244ba1a5d54d79a57a8ee665b18_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=303pt]{gridwind_8c_a4b147244ba1a5d54d79a57a8ee665b18_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{gridwind_8c_a391062d8b219dffc8496bd6fc8128cf6}\label{gridwind_8c_a391062d8b219dffc8496bd6fc8128cf6}} 
\index{gridwind.\+c@{gridwind.\+c}!calloc\+\_\+plasma@{calloc\+\_\+plasma}}
\index{calloc\+\_\+plasma@{calloc\+\_\+plasma}!gridwind.\+c@{gridwind.\+c}}
\subsubsection{\texorpdfstring{calloc\+\_\+plasma()}{calloc\_plasma()}}
{\footnotesize\ttfamily int calloc\+\_\+plasma (\begin{DoxyParamCaption}\item[{int}]{nelem }\end{DoxyParamCaption})}



Allocate memory for plasmamain, which contains temperature, densities, etc. for cells which are in the wind. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em int} & nelem The number of elements of plasmamain to allocate \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns 0, unless the program is unable to allocate the requested memory in which case the program exits
\end{DoxyReturn}
\paragraph*{Notes}

This only allocates elements. It does not populate them with any information.

The routine also allocates space for storing photons associated with each plasma cell. This is used for creating wind photons in a cell in cases where one wants to created multiple photons of a certain type, and generating the cdf for this is time consuming, but generating photons once you have the cdf is not. It is currently used for fb processes only. 

Definition at line 215 of file gridwind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{gridwind_8c_a391062d8b219dffc8496bd6fc8128cf6_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=306pt]{gridwind_8c_a391062d8b219dffc8496bd6fc8128cf6_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{gridwind_8c_af3449f72ae22aca485dfaa4d2f5ae300}\label{gridwind_8c_af3449f72ae22aca485dfaa4d2f5ae300}} 
\index{gridwind.\+c@{gridwind.\+c}!calloc\+\_\+wind@{calloc\+\_\+wind}}
\index{calloc\+\_\+wind@{calloc\+\_\+wind}!gridwind.\+c@{gridwind.\+c}}
\subsubsection{\texorpdfstring{calloc\+\_\+wind()}{calloc\_wind()}}
{\footnotesize\ttfamily int calloc\+\_\+wind (\begin{DoxyParamCaption}\item[{int}]{nelem }\end{DoxyParamCaption})}



Allocate space for the wind domain. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em nelem} & The number of elements in the wind domain to allocate \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns 0 unless there is insufficient space, in which case the routine will call the program to exits
\end{DoxyReturn}
\paragraph*{Notes}

The wind is conisists of grids of cells that paper the active region of the calculation. Each domain has a number of these grid cells. nelem is the total number of such cells. 

Definition at line 158 of file gridwind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{gridwind_8c_af3449f72ae22aca485dfaa4d2f5ae300_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=297pt]{gridwind_8c_af3449f72ae22aca485dfaa4d2f5ae300_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{gridwind_8c_a74097465c23495e007af69e2c66e8d61}\label{gridwind_8c_a74097465c23495e007af69e2c66e8d61}} 
\index{gridwind.\+c@{gridwind.\+c}!check\+\_\+plasma@{check\+\_\+plasma}}
\index{check\+\_\+plasma@{check\+\_\+plasma}!gridwind.\+c@{gridwind.\+c}}
\subsubsection{\texorpdfstring{check\+\_\+plasma()}{check\_plasma()}}
{\footnotesize\ttfamily int check\+\_\+plasma (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_a13ce7664e071685e1c3eaac3c32d7c8d}{Plasma\+Ptr}}]{xplasma,  }\item[{\hyperlink{rdpar_8c_abc6cdcc4db9d9768558d0faa2128c876}{message}}]{ }\end{DoxyParamCaption})}



Check that one is not trying to get information from the dummy Plasma element that is associated with wind elements that are not really in the wind. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Plasma\+Ptr} & xplasma A pointer to the plasma element \\
\hline
\mbox{\tt in}  & {\em char} & message\mbox{[}\mbox{]} A message which is printed out if one has tried to access the dummy Plsma element \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 (False) if one is not in the empty plasma cell, 1 (True) if you have gooten there.
\end{DoxyReturn}
Wind cells that have no associated volume are assigned to the same plasma element. One should never be asked to generate a photon or indeeed have a scattering event in such wind cells. This little routine is just a diagnostic routine that throws an error message if one has gotten into such a situation.

\paragraph*{Notes}

Definition at line 290 of file gridwind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{gridwind_8c_a74097465c23495e007af69e2c66e8d61_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{gridwind_8c_a67af2cd841a922ea1001654449239284}\label{gridwind_8c_a67af2cd841a922ea1001654449239284}} 
\index{gridwind.\+c@{gridwind.\+c}!create\+\_\+maps@{create\+\_\+maps}}
\index{create\+\_\+maps@{create\+\_\+maps}!gridwind.\+c@{gridwind.\+c}}
\subsubsection{\texorpdfstring{create\+\_\+maps()}{create\_maps()}}
{\footnotesize\ttfamily int create\+\_\+maps (\begin{DoxyParamCaption}\item[{int}]{ichoice }\end{DoxyParamCaption})}



Create a map between wind and plasma cells. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em int} & ichoice An option which if non-\/zero indicates that a plasma element exists for each wmain element \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
The routine fills variables, nplasma in wmain, and nwind in plasmamain that map elements of wmain to those in plasmamain anc vice versus

\paragraph*{Notes}

Normally, there are fewer plasma elements than wind elements, since plasma elements are created only for those wind elements which have finite volume in the wind. For each domain, a coordinate grid is created that covers a region of space, e.\+g a portion of a cylindrical grid. However some cells in this region are empty or matter, e.\+g in a binconical flow. However if ichoice is non-\/zero, a plasma cell has been created for all wind cells even if they are empty, something that is done only for diagnostic purposes.

wmain and plasmamain will already have been allocated memory by the time this routine is called. 

Definition at line 88 of file gridwind.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{gridwind_8c_a67af2cd841a922ea1001654449239284_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=302pt]{gridwind_8c_a67af2cd841a922ea1001654449239284_icgraph}
\end{center}
\end{figure}
