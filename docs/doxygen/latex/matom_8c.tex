\hypertarget{matom_8c}{}\section{/\+Users/mhewitt/python/source/matom.c File Reference}
\label{matom_8c}\index{/\+Users/mhewitt/python/source/matom.\+c@{/\+Users/mhewitt/python/source/matom.\+c}}


Macro-\/atom functions.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atomic.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}python.\+h\char`\"{}}\newline
{\ttfamily \#include $<$gsl/gsl\+\_\+block.\+h$>$}\newline
{\ttfamily \#include $<$gsl/gsl\+\_\+vector.\+h$>$}\newline
{\ttfamily \#include $<$gsl/gsl\+\_\+matrix.\+h$>$}\newline
{\ttfamily \#include \char`\"{}my\+\_\+linalg.\+h\char`\"{}}\newline
Include dependency graph for matom.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{matom_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{matom_8c_a4ed02e03274f12b6c0c302f6f0723bc3}{B12\+\_\+\+C\+O\+N\+S\+T\+A\+NT}~5.\+01983e25
\item 
\#define \hyperlink{matom_8c_a5d003db13b4f257723500c23bee10b90}{A\+L\+P\+H\+A\+\_\+\+S\+P\+\_\+\+C\+O\+N\+S\+T\+A\+NT}~5.\+79618e-\/36
\begin{DoxyCompactList}\small\item\em the matom estimator for the spontaneous recombination rate. \end{DoxyCompactList}\item 
\#define \hyperlink{matom_8c_a60902bb874ad5e3684af842ad9a28636}{A\+L\+P\+H\+A\+\_\+\+FF}~100.
\begin{DoxyCompactList}\small\item\em deals with the elimination of k-\/packets. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{matom_8c_a9301eba8fb39302ef3da90cdb52aef4d}{matom} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, int $\ast$\hyperlink{python_8h_ac1f90b11b79f8d2c9a25f12643063ee7}{nres}, int $\ast$escape)
\begin{DoxyCompactList}\small\item\em The core of the implementation of Macro Atoms in python. \end{DoxyCompactList}\item 
double \hyperlink{matom_8c_ac84f4556e3972c1fe39b74fd9b7b4241}{b12} (struct \hyperlink{structlines}{lines} $\ast$line\+\_\+ptr)
\item 
double \hyperlink{matom_8c_a53e97649d5cd9a1fab024ab99489ddb1}{alpha\+\_\+sp} (struct \hyperlink{structtopbase__phot}{topbase\+\_\+phot} $\ast$cont\+\_\+ptr, \hyperlink{python_8h_a13ce7664e071685e1c3eaac3c32d7c8d}{Plasma\+Ptr} \hyperlink{compton_8c_ad65f0d74fe764d3ecae5ec1a89d63f08}{xplasma}, int ichoice)
\item 
double \hyperlink{matom_8c_aee2caf449c574d065a2cf67664783ace}{alpha\+\_\+sp\+\_\+integrand} (double freq)
\begin{DoxyCompactList}\small\item\em This returns the integrand for alpha\+\_\+sp at a chosen frequency -\/. \end{DoxyCompactList}\item 
int \hyperlink{matom_8c_a16ae068adf1746f09c432de7e245dfb1}{kpkt} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, int $\ast$\hyperlink{python_8h_ac1f90b11b79f8d2c9a25f12643063ee7}{nres}, int $\ast$escape)
\item 
int \hyperlink{matom_8c_aa39c27768ea571d93b29aa2bf90e7913}{fake\+\_\+matom\+\_\+bb} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, int $\ast$\hyperlink{python_8h_ac1f90b11b79f8d2c9a25f12643063ee7}{nres}, int $\ast$escape)
\item 
int \hyperlink{matom_8c_a4c03c66dea8a22dd2a87077c816d26c2}{fake\+\_\+matom\+\_\+bf} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, int $\ast$\hyperlink{python_8h_ac1f90b11b79f8d2c9a25f12643063ee7}{nres}, int $\ast$escape)
\item 
int \hyperlink{matom_8c_a9ae82cdebefd0a70326fd37ee0a61fd4}{emit\+\_\+matom} (\hyperlink{python_8h_ad957272e4ddecfb558775b2aeddf2ac4}{Wind\+Ptr} w, \hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, int $\ast$\hyperlink{python_8h_ac1f90b11b79f8d2c9a25f12643063ee7}{nres}, int upper)
\begin{DoxyCompactList}\small\item\em a scaled down version of matom which deals with deactivation only for spectral cycles. \end{DoxyCompactList}\item 
double \hyperlink{matom_8c_ac60407b8b44d5a57ec6c89122058dcf7}{matom\+\_\+emit\+\_\+in\+\_\+line\+\_\+prob} (\hyperlink{python_8h_ad957272e4ddecfb558775b2aeddf2ac4}{Wind\+Ptr} one, struct \hyperlink{structlines}{lines} $\ast$line\+\_\+ptr\+\_\+emit)
\begin{DoxyCompactList}\small\item\em Prob. of cell emitting in a given line. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structlines}{lines} $\ast$ \hyperlink{matom_8c_a2838268e309f2158a6c2948c92a299f9}{b12\+\_\+line\+\_\+ptr}
\item 
double \hyperlink{matom_8c_a91b6db8e31726e041b1fc93ce0338a1b}{b12\+\_\+a}
\item 
struct \hyperlink{structtopbase__phot}{topbase\+\_\+phot} $\ast$ \hyperlink{matom_8c_a4870118e9da8bf1f4cdc629cfd2efc96}{cont\+\_\+ext\+\_\+ptr}
\item 
double \hyperlink{matom_8c_a251b07cd6698a386f4306ff7cfb1a481}{temp\+\_\+ext}
\item 
int \hyperlink{matom_8c_a55d2fd6a10cba375e78a3045d99d7714}{temp\+\_\+choice}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Macro-\/atom functions. 

\begin{DoxyAuthor}{Author}
S\+WM 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
February, 2004 File containing Macro-\/atom functions. 
\end{DoxyDate}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{matom_8c_a60902bb874ad5e3684af842ad9a28636}\label{matom_8c_a60902bb874ad5e3684af842ad9a28636}} 
\index{matom.\+c@{matom.\+c}!A\+L\+P\+H\+A\+\_\+\+FF@{A\+L\+P\+H\+A\+\_\+\+FF}}
\index{A\+L\+P\+H\+A\+\_\+\+FF@{A\+L\+P\+H\+A\+\_\+\+FF}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{A\+L\+P\+H\+A\+\_\+\+FF}{ALPHA\_FF}}
{\footnotesize\ttfamily \#define A\+L\+P\+H\+A\+\_\+\+FF~100.}



deals with the elimination of k-\/packets. 

Whenever a k-\/packet is created it is immediately destroyed insitu by this routine. At output \char`\"{}nres\char`\"{} identified the process that destroys the k-\/packet and the packet information has been updated in the same way as at the end of matom


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Wind\+Ptr} & w the ptr to the structure defining the wind \\
\hline
\mbox{\tt in,out}  & {\em Phot\+Ptr} & p the packet at the point of activation and deactivation \\
\hline
\mbox{\tt in,out}  & {\em int} & nres the process which activates and deactivates the Macro Atom \\
\hline
\mbox{\tt in,out}  & {\em int} & escape to tell us whether the matom de-\/activation is via an r-\/packet (1) or a k-\/packet (0) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0
\end{DoxyReturn}
\paragraph*{Notes}

Mar 04 SS Coding began. Apr 04 SS Various improvements including the addition of ff and collisions. May 04 SS Minor changes made to collisional cooling rates (bug fixed) and fb cooling for simple continua. May 04 SS Modified to work for case with all \char`\"{}simple\char`\"{} ions. May 04 SS Modified to use \char`\"{}scattering probability\char`\"{} formalism for simple ion cooling rates. Jun 04 SS Modified to include the \char`\"{}escape\char`\"{} variable to identify excitation of macro atoms. This removes the need to call matom from within this routine. Jun 04 SS Modified to include collisional ionization as a cooling term. July04 SS Modified to use recomb\+\_\+sp(\+\_\+e) rather than alpha\+\_\+sp(\+\_\+e) to speed up. 06may ksl 57+ -- Modified to use new plasma array. Eliminated passing entire w array 131030 JM -- Added adiabatic cooling as possible kpkt destruction choice 

Definition at line 684 of file matom.\+c.

\mbox{\Hypertarget{matom_8c_a5d003db13b4f257723500c23bee10b90}\label{matom_8c_a5d003db13b4f257723500c23bee10b90}} 
\index{matom.\+c@{matom.\+c}!A\+L\+P\+H\+A\+\_\+\+S\+P\+\_\+\+C\+O\+N\+S\+T\+A\+NT@{A\+L\+P\+H\+A\+\_\+\+S\+P\+\_\+\+C\+O\+N\+S\+T\+A\+NT}}
\index{A\+L\+P\+H\+A\+\_\+\+S\+P\+\_\+\+C\+O\+N\+S\+T\+A\+NT@{A\+L\+P\+H\+A\+\_\+\+S\+P\+\_\+\+C\+O\+N\+S\+T\+A\+NT}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{A\+L\+P\+H\+A\+\_\+\+S\+P\+\_\+\+C\+O\+N\+S\+T\+A\+NT}{ALPHA\_SP\_CONSTANT}}
{\footnotesize\ttfamily \#define A\+L\+P\+H\+A\+\_\+\+S\+P\+\_\+\+C\+O\+N\+S\+T\+A\+NT~5.\+79618e-\/36}



the matom estimator for the spontaneous recombination rate. 

The rate is given by

(4 pi /c2) (gu/gl) (h2/2 pi m k T)$^\wedge$(3/2) times the integral of a(nu) nu2 exp \mbox{[}(chi-\/ h nu)/kT\mbox{]}.

\paragraph*{Notes}

04jul30 ksl Modified so that one does not need to have multiple versions of the code depending on how whether the integrand is multiplied by 1, f/fthresh, or f/fthresh-\/1. This was done eliminate alpha\+\_\+sp\+\_\+e as a separate set of routines and to assure that bf rates are positive ichoice = 0 --$>$ spontanous recombination ichoice = 1 --$>$ energy weighted recombination ichoice = 2 --$>$ the difference between energy\+\_\+weighted and spontaneous

06may ksl 57+ -- Modified to use plasma structure 

Definition at line 581 of file matom.\+c.

\mbox{\Hypertarget{matom_8c_a4ed02e03274f12b6c0c302f6f0723bc3}\label{matom_8c_a4ed02e03274f12b6c0c302f6f0723bc3}} 
\index{matom.\+c@{matom.\+c}!B12\+\_\+\+C\+O\+N\+S\+T\+A\+NT@{B12\+\_\+\+C\+O\+N\+S\+T\+A\+NT}}
\index{B12\+\_\+\+C\+O\+N\+S\+T\+A\+NT@{B12\+\_\+\+C\+O\+N\+S\+T\+A\+NT}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{B12\+\_\+\+C\+O\+N\+S\+T\+A\+NT}{B12\_CONSTANT}}
{\footnotesize\ttfamily \#define B12\+\_\+\+C\+O\+N\+S\+T\+A\+NT~5.\+01983e25}



Definition at line 524 of file matom.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{matom_8c_a53e97649d5cd9a1fab024ab99489ddb1}\label{matom_8c_a53e97649d5cd9a1fab024ab99489ddb1}} 
\index{matom.\+c@{matom.\+c}!alpha\+\_\+sp@{alpha\+\_\+sp}}
\index{alpha\+\_\+sp@{alpha\+\_\+sp}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{alpha\+\_\+sp()}{alpha\_sp()}}
{\footnotesize\ttfamily double alpha\+\_\+sp (\begin{DoxyParamCaption}\item[{struct \hyperlink{structtopbase__phot}{topbase\+\_\+phot} $\ast$}]{cont\+\_\+ptr,  }\item[{\hyperlink{python_8h_a13ce7664e071685e1c3eaac3c32d7c8d}{Plasma\+Ptr}}]{xplasma,  }\item[{int}]{ichoice }\end{DoxyParamCaption})}



Definition at line 584 of file matom.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=336pt]{matom_8c_a53e97649d5cd9a1fab024ab99489ddb1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{matom_8c_a53e97649d5cd9a1fab024ab99489ddb1_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{matom_8c_aee2caf449c574d065a2cf67664783ace}\label{matom_8c_aee2caf449c574d065a2cf67664783ace}} 
\index{matom.\+c@{matom.\+c}!alpha\+\_\+sp\+\_\+integrand@{alpha\+\_\+sp\+\_\+integrand}}
\index{alpha\+\_\+sp\+\_\+integrand@{alpha\+\_\+sp\+\_\+integrand}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{alpha\+\_\+sp\+\_\+integrand()}{alpha\_sp\_integrand()}}
{\footnotesize\ttfamily double alpha\+\_\+sp\+\_\+integrand (\begin{DoxyParamCaption}\item[{double}]{freq }\end{DoxyParamCaption})}



This returns the integrand for alpha\+\_\+sp at a chosen frequency -\/. 



Definition at line 625 of file matom.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=253pt]{matom_8c_aee2caf449c574d065a2cf67664783ace_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{matom_8c_aee2caf449c574d065a2cf67664783ace_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{matom_8c_ac84f4556e3972c1fe39b74fd9b7b4241}\label{matom_8c_ac84f4556e3972c1fe39b74fd9b7b4241}} 
\index{matom.\+c@{matom.\+c}!b12@{b12}}
\index{b12@{b12}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{b12()}{b12()}}
{\footnotesize\ttfamily double b12 (\begin{DoxyParamCaption}\item[{struct \hyperlink{structlines}{lines} $\ast$}]{line\+\_\+ptr }\end{DoxyParamCaption})}



Definition at line 530 of file matom.\+c.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=308pt]{matom_8c_ac84f4556e3972c1fe39b74fd9b7b4241_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{matom_8c_a9ae82cdebefd0a70326fd37ee0a61fd4}\label{matom_8c_a9ae82cdebefd0a70326fd37ee0a61fd4}} 
\index{matom.\+c@{matom.\+c}!emit\+\_\+matom@{emit\+\_\+matom}}
\index{emit\+\_\+matom@{emit\+\_\+matom}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{emit\+\_\+matom()}{emit\_matom()}}
{\footnotesize\ttfamily int emit\+\_\+matom (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad957272e4ddecfb558775b2aeddf2ac4}{Wind\+Ptr}}]{w,  }\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{int $\ast$}]{nres,  }\item[{int}]{upper }\end{DoxyParamCaption})}



a scaled down version of matom which deals with deactivation only for spectral cycles. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Wind\+Ptr} & w the ptr to the structure defining the wind \\
\hline
\mbox{\tt in}  & {\em int} & upper the upper level that we deactivate from \\
\hline
\mbox{\tt in,out}  & {\em Phot\+Ptr} & p the packet at the point of activation and deactivation \\
\hline
\mbox{\tt in,out}  & {\em int} & nres the process by which deactivation occurs \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0
\end{DoxyReturn}
emit\+\_\+matom is a scaled down version of matom which deals with the emission due to deactivating macro atoms in the detailed spectrum part of the calculation.

\paragraph*{Notes}

Definition at line 1323 of file matom.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{matom_8c_a9ae82cdebefd0a70326fd37ee0a61fd4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=253pt]{matom_8c_a9ae82cdebefd0a70326fd37ee0a61fd4_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{matom_8c_aa39c27768ea571d93b29aa2bf90e7913}\label{matom_8c_aa39c27768ea571d93b29aa2bf90e7913}} 
\index{matom.\+c@{matom.\+c}!fake\+\_\+matom\+\_\+bb@{fake\+\_\+matom\+\_\+bb}}
\index{fake\+\_\+matom\+\_\+bb@{fake\+\_\+matom\+\_\+bb}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{fake\+\_\+matom\+\_\+bb()}{fake\_matom\_bb()}}
{\footnotesize\ttfamily int fake\+\_\+matom\+\_\+bb (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{int $\ast$}]{nres,  }\item[{int $\ast$}]{escape }\end{DoxyParamCaption})}



Definition at line 1159 of file matom.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=258pt]{matom_8c_aa39c27768ea571d93b29aa2bf90e7913_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=240pt]{matom_8c_aa39c27768ea571d93b29aa2bf90e7913_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{matom_8c_a4c03c66dea8a22dd2a87077c816d26c2}\label{matom_8c_a4c03c66dea8a22dd2a87077c816d26c2}} 
\index{matom.\+c@{matom.\+c}!fake\+\_\+matom\+\_\+bf@{fake\+\_\+matom\+\_\+bf}}
\index{fake\+\_\+matom\+\_\+bf@{fake\+\_\+matom\+\_\+bf}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{fake\+\_\+matom\+\_\+bf()}{fake\_matom\_bf()}}
{\footnotesize\ttfamily int fake\+\_\+matom\+\_\+bf (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{int $\ast$}]{nres,  }\item[{int $\ast$}]{escape }\end{DoxyParamCaption})}



Definition at line 1276 of file matom.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=256pt]{matom_8c_a4c03c66dea8a22dd2a87077c816d26c2_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=238pt]{matom_8c_a4c03c66dea8a22dd2a87077c816d26c2_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{matom_8c_a16ae068adf1746f09c432de7e245dfb1}\label{matom_8c_a16ae068adf1746f09c432de7e245dfb1}} 
\index{matom.\+c@{matom.\+c}!kpkt@{kpkt}}
\index{kpkt@{kpkt}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{kpkt()}{kpkt()}}
{\footnotesize\ttfamily int kpkt (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{int $\ast$}]{nres,  }\item[{int $\ast$}]{escape }\end{DoxyParamCaption})}



Definition at line 687 of file matom.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{matom_8c_a16ae068adf1746f09c432de7e245dfb1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=216pt]{matom_8c_a16ae068adf1746f09c432de7e245dfb1_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{matom_8c_a9301eba8fb39302ef3da90cdb52aef4d}\label{matom_8c_a9301eba8fb39302ef3da90cdb52aef4d}} 
\index{matom.\+c@{matom.\+c}!matom@{matom}}
\index{matom@{matom}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{matom()}{matom()}}
{\footnotesize\ttfamily int matom (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{int $\ast$}]{nres,  }\item[{int $\ast$}]{escape }\end{DoxyParamCaption})}



The core of the implementation of Macro Atoms in python. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Wind\+Ptr} & w the ptr to the structure defining the wind \\
\hline
\mbox{\tt in,out}  & {\em Phot\+Ptr} & p the packet at the point of activation and deactivation \\
\hline
\mbox{\tt in,out}  & {\em int} & nres the process which activates and deactivates the Macro Atom \\
\hline
\mbox{\tt in,out}  & {\em int} & escape to tell us whether the matom de-\/activation is via an r-\/packet (1) or a k-\/packet (0) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0
\end{DoxyReturn}
Matom is the core of the implementation of Leon Lucy\textquotesingle{}s Macro Atom approach to dealing with radiation-\/matter interactions. It is called whenever a photon packet activates a macro atom. As input it takes the process by which activation occurred (identified by the label \char`\"{}nres\char`\"{}) which allow it to deduce the level that has been excited. It then calculates all the Macro Atom jumping/deactivaion probabilities following Lucy and so deduces the process by which deactivation occurs. At output \char`\"{}nres\char`\"{} identifies this process and the packet information has been updated.

\paragraph*{Notes}

ksl-- There is a lot of arithmetic required to keep track of indices. I would be inclined to figure out a way to avoid this. One possibility would be to record the go\+\_\+to level in an array when one is calculating the emission probabilities. This would make it easier to add new processes, I suspect.

It would be possible to convert the for loop to a while statement. This would avoid the break statement in the middle.

History\+: Feb 04 SS Coding began. Mar 04 SS Minor changes made (based on comments from ksl) 04apr ksl A. Eliminated some unnecessary if statements. These are indicated by the words extra. Stuart should remove the lines assuming he agrees. B. Changed the logic of the major do loop so that the break is moved higher in the do loop. Stuart, the intent is to make the code more readable, and to reduce the level of nesting. C. Corrected an errror that on upward bb transitions seemed to leave the macro-\/atom in the same state as previously. D. Shamelessly modified some of the comments to make it more straightforward for me to understand. E. m = m + 1 --$>$ m++ in several places F. Modified selections to allow simple lines to be read in but not to affect matom. nlines\+\_\+macro is the number on macro-\/lines read in and these are the first elements in the line structure G. Modified the way matom determines that a transition is a photo ionization transition bo be consitent with change made in resonate. Apr 04 SS Modifications to include collisional jumps/deactivation included. May 04 SS Bug corrected for identification of line (nres is the place of the line in the O\+R\+D\+E\+R\+ED list, not the input list). Jun 04 SS Modified to carry the \char`\"{}escape\char`\"{} variable to identify de-\/activation via r-\/packets and k-\/packets -\/ avoids the need to call kpkt from within this routine Jun 04 SS Adding collisional ionization as an upwards jump possibility. No collisional recombination for the moment. Jun 04 SS Now putting in collisional recombination too. July04 SS Modifying so that this routine does not call alpha\+\_\+sp but rather uses pre-\/computed (stored values) for the spontaneous recombination coefficient. This is an effort to speed up the code. 06may ksl 57+ -- Adapted for use with plsama structure. Changed call to eliminate passing entire w array 06jun ksl 57g -- Split macro variables into a separate structure. The structue which is createdin gridwind, is only created if there are macroatoms. 06jul ksl 57h -- In the process of speeding up the program in the simple non-\/macro atom case, I tried to make sure that matom and the derivative routiens were not called at all. Note that at present the macroatom case is quite slow, due to what is happening in matom. I am suspicious that it could be speeded up a lot. 07jul SS Experimenting with retaining jumping/emission probabilities to save time. 

Definition at line 97 of file matom.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{matom_8c_a9301eba8fb39302ef3da90cdb52aef4d_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=209pt]{matom_8c_a9301eba8fb39302ef3da90cdb52aef4d_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{matom_8c_ac60407b8b44d5a57ec6c89122058dcf7}\label{matom_8c_ac60407b8b44d5a57ec6c89122058dcf7}} 
\index{matom.\+c@{matom.\+c}!matom\+\_\+emit\+\_\+in\+\_\+line\+\_\+prob@{matom\+\_\+emit\+\_\+in\+\_\+line\+\_\+prob}}
\index{matom\+\_\+emit\+\_\+in\+\_\+line\+\_\+prob@{matom\+\_\+emit\+\_\+in\+\_\+line\+\_\+prob}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{matom\+\_\+emit\+\_\+in\+\_\+line\+\_\+prob()}{matom\_emit\_in\_line\_prob()}}
{\footnotesize\ttfamily double matom\+\_\+emit\+\_\+in\+\_\+line\+\_\+prob (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad957272e4ddecfb558775b2aeddf2ac4}{Wind\+Ptr}}]{one,  }\item[{struct \hyperlink{structlines}{lines} $\ast$}]{line\+\_\+ptr\+\_\+emit }\end{DoxyParamCaption})}



Prob. of cell emitting in a given line. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em one} & Pointer to cell of interest \\
\hline
\mbox{\tt in}  & {\em line\+\_\+ptr\+\_\+emit} & Pointer to line of interest \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Probability of line emission
\end{DoxyReturn}
Given a cell and a line, calculates the probabiltiy that that cell will emit in that line.

\paragraph*{Notes}

6/15 -\/ Written by S\+WM 

Definition at line 1497 of file matom.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{matom_8c_ac60407b8b44d5a57ec6c89122058dcf7_cgraph}
\end{center}
\end{figure}


\subsection{Variable Documentation}
\mbox{\Hypertarget{matom_8c_a91b6db8e31726e041b1fc93ce0338a1b}\label{matom_8c_a91b6db8e31726e041b1fc93ce0338a1b}} 
\index{matom.\+c@{matom.\+c}!b12\+\_\+a@{b12\+\_\+a}}
\index{b12\+\_\+a@{b12\+\_\+a}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{b12\+\_\+a}{b12\_a}}
{\footnotesize\ttfamily double b12\+\_\+a}



Definition at line 527 of file matom.\+c.

\mbox{\Hypertarget{matom_8c_a2838268e309f2158a6c2948c92a299f9}\label{matom_8c_a2838268e309f2158a6c2948c92a299f9}} 
\index{matom.\+c@{matom.\+c}!b12\+\_\+line\+\_\+ptr@{b12\+\_\+line\+\_\+ptr}}
\index{b12\+\_\+line\+\_\+ptr@{b12\+\_\+line\+\_\+ptr}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{b12\+\_\+line\+\_\+ptr}{b12\_line\_ptr}}
{\footnotesize\ttfamily struct \hyperlink{structlines}{lines}$\ast$ b12\+\_\+line\+\_\+ptr}



Definition at line 526 of file matom.\+c.

\mbox{\Hypertarget{matom_8c_a4870118e9da8bf1f4cdc629cfd2efc96}\label{matom_8c_a4870118e9da8bf1f4cdc629cfd2efc96}} 
\index{matom.\+c@{matom.\+c}!cont\+\_\+ext\+\_\+ptr@{cont\+\_\+ext\+\_\+ptr}}
\index{cont\+\_\+ext\+\_\+ptr@{cont\+\_\+ext\+\_\+ptr}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{cont\+\_\+ext\+\_\+ptr}{cont\_ext\_ptr}}
{\footnotesize\ttfamily struct \hyperlink{structtopbase__phot}{topbase\+\_\+phot}$\ast$ cont\+\_\+ext\+\_\+ptr}



Definition at line 550 of file matom.\+c.

\mbox{\Hypertarget{matom_8c_a55d2fd6a10cba375e78a3045d99d7714}\label{matom_8c_a55d2fd6a10cba375e78a3045d99d7714}} 
\index{matom.\+c@{matom.\+c}!temp\+\_\+choice@{temp\+\_\+choice}}
\index{temp\+\_\+choice@{temp\+\_\+choice}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{temp\+\_\+choice}{temp\_choice}}
{\footnotesize\ttfamily int temp\+\_\+choice}



Definition at line 552 of file matom.\+c.

\mbox{\Hypertarget{matom_8c_a251b07cd6698a386f4306ff7cfb1a481}\label{matom_8c_a251b07cd6698a386f4306ff7cfb1a481}} 
\index{matom.\+c@{matom.\+c}!temp\+\_\+ext@{temp\+\_\+ext}}
\index{temp\+\_\+ext@{temp\+\_\+ext}!matom.\+c@{matom.\+c}}
\subsubsection{\texorpdfstring{temp\+\_\+ext}{temp\_ext}}
{\footnotesize\ttfamily double temp\+\_\+ext}



Definition at line 551 of file matom.\+c.

