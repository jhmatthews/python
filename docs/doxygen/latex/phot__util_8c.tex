\hypertarget{phot__util_8c}{}\section{/\+Users/mhewitt/python/source/phot\+\_\+util.c File Reference}
\label{phot__util_8c}\index{/\+Users/mhewitt/python/source/phot\+\_\+util.\+c@{/\+Users/mhewitt/python/source/phot\+\_\+util.\+c}}


This file contains utilities which can be used to work with photon structues. It also contains routines to calculate the distances to intersections of spheres and cones. The routines included here should not be tightly tied to a particular wind model. The one exception at present is ds\+\_\+to\+\_\+cone which calculates the distance to a bifurcated cone.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include $<$time.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atomic.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}python.\+h\char`\"{}}\newline
Include dependency graph for phot\+\_\+util.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{phot__util_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{phot__util_8c_a1c6dc9c24a43e2bc6319b23faba4a041}{stuff\+\_\+phot} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} pin, \hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} pout)
\begin{DoxyCompactList}\small\item\em Simply copy one photon bundle into another. \end{DoxyCompactList}\item 
int \hyperlink{phot__util_8c_a8f17a1e86112f24760862d998129d91c}{move\+\_\+phot} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} pp, double ds)
\begin{DoxyCompactList}\small\item\em move a photon by a distance ds \end{DoxyCompactList}\item 
int \hyperlink{phot__util_8c_a54b6ecee57eb3cb519fde55290c02f1b}{comp\+\_\+phot} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p1, \hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p2)
\begin{DoxyCompactList}\small\item\em Compares two photons to determine whether they have the identical position and direction. \end{DoxyCompactList}\item 
int \hyperlink{phot__util_8c_a56bcc4eb80e38e626fe58bb5c989eafd}{phot\+\_\+hist} (\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, int iswitch)
\begin{DoxyCompactList}\small\item\em Record the history of a single photon bundle, in terms of a series of photon structures that are populated as the photon goes through the grid. \end{DoxyCompactList}\item 
int \hyperlink{phot__util_8c_a13bf02e4a8315e90c84ae43b42fde4b6}{phot\+\_\+history\+\_\+summarize} ()
\begin{DoxyCompactList}\small\item\em The next routine is designed to update a portion of the Plasma\+Ptr to reflect where photons along the line of sight to the observer were absorbed in the wind. \end{DoxyCompactList}\item 
double \hyperlink{phot__util_8c_a4a0398c1230c6d21c5c51f4750ca2ea1}{ds\+\_\+to\+\_\+cone} (\hyperlink{python_8h_a24207bf0bce7d09eb68cd114e725996d}{Cone\+Ptr} cc, struct \hyperlink{structphoton}{photon} $\ast$p)
\begin{DoxyCompactList}\small\item\em (cc, p) This is a new version of introduced in order to allow cylvar coordinates Eventually it is intended to replace ds\+\_\+to\+\_\+windcone completely, or at least the guts of ds\+\_\+to\+\_\+windcone. \end{DoxyCompactList}\item 
double \hyperlink{phot__util_8c_a67e3cb7a7d0cd3d55277fc4f3373fe2e}{ds\+\_\+to\+\_\+sphere} (double \hyperlink{import__spherical_8c_a83175ac8fd9d924ff2bce40c99e88870}{r}, struct \hyperlink{structphoton}{photon} $\ast$p)
\begin{DoxyCompactList}\small\item\em Calculate the pathlenth along a line of sight defined by a photon p to a sphere centered on the origin. \end{DoxyCompactList}\item 
double \hyperlink{phot__util_8c_a8656562abff4020df988426338e79eca}{ds\+\_\+to\+\_\+sphere2} (\hyperlink{import__cylindrical_8c_a099bc7b5a9501685180c163c1ffb67d0}{x}, \hyperlink{import__spherical_8c_a83175ac8fd9d924ff2bce40c99e88870}{r}, struct \hyperlink{structphoton}{photon} $\ast$p)
\begin{DoxyCompactList}\small\item\em Find the positive distance to a sphere centered at x with radius r. \end{DoxyCompactList}\item 
int \hyperlink{phot__util_8c_aba2cef648adc07ade76f313650e627ab}{quadratic} (double a, double b, double c, \hyperlink{import__spherical_8c_a83175ac8fd9d924ff2bce40c99e88870}{r})
\begin{DoxyCompactList}\small\item\em This solves a simple quadratic (or if a is zero linear) equation. \end{DoxyCompactList}\item 
double \hyperlink{phot__util_8c_ae443765b508c1d69ac5249ef9de2bb81}{ds\+\_\+to\+\_\+plane} (struct \hyperlink{structplane}{plane} $\ast$pl, struct \hyperlink{structphoton}{photon} $\ast$p)
\begin{DoxyCompactList}\small\item\em calculates the distance of a photon must travel to hit the plane. \end{DoxyCompactList}\item 
double \hyperlink{phot__util_8c_a8b9698b536acf2ec47097c93fb6c81f0}{ds\+\_\+to\+\_\+closest\+\_\+approach} (\hyperlink{import__cylindrical_8c_a099bc7b5a9501685180c163c1ffb67d0}{x}, struct \hyperlink{structphoton}{photon} $\ast$p, double $\ast$impact\+\_\+parameter)
\begin{DoxyCompactList}\small\item\em This routine calculates the distance a photon has to be moved to reach the point of closest approach to a point described by x and also calculates the distance of closest approach (i.\+e. the impact parameter). \end{DoxyCompactList}\item 
double \hyperlink{phot__util_8c_abca5dd4cfb2140628e2a8f8be27aa2ee}{ds\+\_\+to\+\_\+cylinder} (double \hyperlink{wind2d_8c_a078472458c0ac73f723c094fc2121c14}{rho}, struct \hyperlink{structphoton}{photon} $\ast$p)
\begin{DoxyCompactList}\small\item\em calculate the distance a photon must travel to encouter a cylinder that is centered on the z axis. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{phot__util_8c_a0791b17bafbcf6e30d7bbeffa2c1cec4}{init\+\_\+stuff\+\_\+phot} = 0
\item 
size\+\_\+t \hyperlink{phot__util_8c_ad063cb5ecb88d7c02392bcb4b84a942d}{sizeofphot}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
This file contains utilities which can be used to work with photon structues. It also contains routines to calculate the distances to intersections of spheres and cones. The routines included here should not be tightly tied to a particular wind model. The one exception at present is ds\+\_\+to\+\_\+cone which calculates the distance to a bifurcated cone. 

\begin{DoxyAuthor}{Author}
ksl 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
January, 2018 
\end{DoxyDate}


\subsection{Function Documentation}
\mbox{\Hypertarget{phot__util_8c_a54b6ecee57eb3cb519fde55290c02f1b}\label{phot__util_8c_a54b6ecee57eb3cb519fde55290c02f1b}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!comp\+\_\+phot@{comp\+\_\+phot}}
\index{comp\+\_\+phot@{comp\+\_\+phot}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{comp\+\_\+phot()}{comp\_phot()}}
{\footnotesize\ttfamily int comp\+\_\+phot (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p1,  }\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p2 }\end{DoxyParamCaption})}



Compares two photons to determine whether they have the identical position and direction. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Phot\+Ptr} & p1 The first photon bundle \\
\hline
\mbox{\tt in}  & {\em Phot\+Ptr} & p2 The second phton bundle \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns 0 if the position and direction are identical, 1 otherwise
\end{DoxyReturn}
\paragraph*{Notes}

The routine is used in calculate\+\_\+ds 

Definition at line 133 of file phot\+\_\+util.\+c.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=228pt]{phot__util_8c_a54b6ecee57eb3cb519fde55290c02f1b_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{phot__util_8c_a8b9698b536acf2ec47097c93fb6c81f0}\label{phot__util_8c_a8b9698b536acf2ec47097c93fb6c81f0}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!ds\+\_\+to\+\_\+closest\+\_\+approach@{ds\+\_\+to\+\_\+closest\+\_\+approach}}
\index{ds\+\_\+to\+\_\+closest\+\_\+approach@{ds\+\_\+to\+\_\+closest\+\_\+approach}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{ds\+\_\+to\+\_\+closest\+\_\+approach()}{ds\_to\_closest\_approach()}}
{\footnotesize\ttfamily double ds\+\_\+to\+\_\+closest\+\_\+approach (\begin{DoxyParamCaption}\item[{\hyperlink{import__cylindrical_8c_a099bc7b5a9501685180c163c1ffb67d0}{x}}]{,  }\item[{struct \hyperlink{structphoton}{photon} $\ast$}]{p,  }\item[{double $\ast$}]{impact\+\_\+parameter }\end{DoxyParamCaption})}



This routine calculates the distance a photon has to be moved to reach the point of closest approach to a point described by x and also calculates the distance of closest approach (i.\+e. the impact parameter). 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em double} & x\mbox{[}\mbox{]} A position in space \\
\hline
\mbox{\tt in}  & {\em struct} & photon $\ast$ p A photon bundle \\
\hline
\mbox{\tt out}  & {\em double} & $\ast$ impact\+\_\+parameter The distance of closest approach of the photon \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The distance the photon would have to be moved to reach the point of closest approach, which can be negative
\end{DoxyReturn}
\paragraph*{Notes}

Definition at line 859 of file phot\+\_\+util.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=253pt]{phot__util_8c_a8b9698b536acf2ec47097c93fb6c81f0_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{phot__util_8c_a4a0398c1230c6d21c5c51f4750ca2ea1}\label{phot__util_8c_a4a0398c1230c6d21c5c51f4750ca2ea1}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!ds\+\_\+to\+\_\+cone@{ds\+\_\+to\+\_\+cone}}
\index{ds\+\_\+to\+\_\+cone@{ds\+\_\+to\+\_\+cone}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{ds\+\_\+to\+\_\+cone()}{ds\_to\_cone()}}
{\footnotesize\ttfamily double ds\+\_\+to\+\_\+cone (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_a24207bf0bce7d09eb68cd114e725996d}{Cone\+Ptr}}]{cc,  }\item[{struct \hyperlink{structphoton}{photon} $\ast$}]{p }\end{DoxyParamCaption})}



(cc, p) This is a new version of introduced in order to allow cylvar coordinates Eventually it is intended to replace ds\+\_\+to\+\_\+windcone completely, or at least the guts of ds\+\_\+to\+\_\+windcone. 

$<$N\+O\+TE\+: The \mbox{[}in, out\mbox{]} tag describes if the value of a parameter is used or altered. If it is used but not altered, delete \textquotesingle{}O\+UT\textquotesingle{}. If the original value is not used and it is written to, delete \textquotesingle{}IN\textquotesingle{}.$>$ 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em Cone\+Ptr} & cc ??? \\
\hline
\mbox{\tt in,out}  & {\em struct} & photon $\ast$ p ??? \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
??? R\+E\+T\+U\+R\+NS ???
\end{DoxyReturn}
??? D\+E\+S\+C\+R\+I\+P\+T\+I\+ON ???

\paragraph*{Notes}

As part of the conversion, the old ds\+\_\+to\+\_\+cone was renamed to ds\+\_\+to\+\_\+windcone

\begin{DoxyVerb}56d -- Cones have become more prominent in python with time.  Originally
they were used simply to define the inner and outer edges of the
wind, that is   to determine when a photon entered the wind.  The wind was/is
assumed to be a biconical flow, and therefore the most naturally was defined in
terms of a footpoint in the disk for the innermost/outermost stream line
and a slope.

It was expanced when rtheta coordanates were introduced
to handle find when one had hit the theta coordinate boundaries.  And in
56d we also want it to handle the case where the grid cells have variable
z coordinates.  Therefore one needs to be quite careful, Since ds_to_cone
is the ultimate name of the routine I would like to use, the first step
I took was to change the name of the old routine to ds_to_windcone.  This
should allow me to replace the old routine incrementally.

56d -- With python 56d the variable defining a cone were changed to be
the point on the z axis intercepted by the cone (extended) through
the disk, and the slope.

Our approach is as follows:

The cone is defined by  z=z_o + dz/drho *drho
The photon is defined by X=X_o + LMN s

Unless dz/drho = 0, this turns into a simple quadratic equation that must
be solved.  We work in the northen hemisphere only.

There are issues concerning what to do so one crosses the disk plane.  For
    finding how far a photon can travel in a cell, we are *not* interested
in the possibility that the photon hits the cone on the other side of
the disk plane, but for a photon travelling out of the wind we are
very interested in this possibility.\end{DoxyVerb}
 

Definition at line 439 of file phot\+\_\+util.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=220pt]{phot__util_8c_a4a0398c1230c6d21c5c51f4750ca2ea1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{phot__util_8c_a4a0398c1230c6d21c5c51f4750ca2ea1_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{phot__util_8c_abca5dd4cfb2140628e2a8f8be27aa2ee}\label{phot__util_8c_abca5dd4cfb2140628e2a8f8be27aa2ee}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!ds\+\_\+to\+\_\+cylinder@{ds\+\_\+to\+\_\+cylinder}}
\index{ds\+\_\+to\+\_\+cylinder@{ds\+\_\+to\+\_\+cylinder}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{ds\+\_\+to\+\_\+cylinder()}{ds\_to\_cylinder()}}
{\footnotesize\ttfamily double ds\+\_\+to\+\_\+cylinder (\begin{DoxyParamCaption}\item[{double}]{rho,  }\item[{struct \hyperlink{structphoton}{photon} $\ast$}]{p }\end{DoxyParamCaption})}



calculate the distance a photon must travel to encouter a cylinder that is centered on the z axis. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em double} & rho the size of the cylinder \\
\hline
\mbox{\tt in,out}  & {\em struct} & photon $\ast$ p a photon ptr \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The smallest positive distance to the cylinder. If the ray does not hit the cylinder a V\+E\+R\+Y\+\_\+\+B\+IG is returned.
\end{DoxyReturn}
Given a position and a direction the distance to a cylinder, solve the simple quadratic equation that gives the distance to the cylinder.

\paragraph*{Notes}

Definition at line 940 of file phot\+\_\+util.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=228pt]{phot__util_8c_abca5dd4cfb2140628e2a8f8be27aa2ee_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{phot__util_8c_abca5dd4cfb2140628e2a8f8be27aa2ee_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{phot__util_8c_ae443765b508c1d69ac5249ef9de2bb81}\label{phot__util_8c_ae443765b508c1d69ac5249ef9de2bb81}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!ds\+\_\+to\+\_\+plane@{ds\+\_\+to\+\_\+plane}}
\index{ds\+\_\+to\+\_\+plane@{ds\+\_\+to\+\_\+plane}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{ds\+\_\+to\+\_\+plane()}{ds\_to\_plane()}}
{\footnotesize\ttfamily double ds\+\_\+to\+\_\+plane (\begin{DoxyParamCaption}\item[{struct \hyperlink{structplane}{plane} $\ast$}]{pl,  }\item[{struct \hyperlink{structphoton}{photon} $\ast$}]{p }\end{DoxyParamCaption})}



calculates the distance of a photon must travel to hit the plane. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em struct} & plane $\ast$ pl A structure which descibes a plane in terms of a position and vector normal to the surface \\
\hline
\mbox{\tt in,out}  & {\em struct} & photon $\ast$ p A photon \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The distance to the plane, or V\+E\+R\+Y\+\_\+\+B\+IG if the photon does not hit the plane (in the positive direction)
\end{DoxyReturn}
Calcululate the distance a photon must travel to hit a plane. The plane, just for simplicity, is defined as a photon structure since you need both a point and a direction to define it. A plane can be defined by a position x\+\_\+p and a normal lmn\+\_\+p. If the photon ray is then defined by x=x\+\_\+v+s lmn\+\_\+v and the allowed values of s are determined by the equation

(x\+\_\+v+s lmn\+\_\+v -\/ x\+\_\+p) . lmn\+\_\+p=0 where . implies the dot-\/product. The routine returns V\+E\+R\+Y\+\_\+\+B\+IG if the photon ray does not intersect the plane .

\paragraph*{Notes}

Definition at line 794 of file phot\+\_\+util.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=205pt]{phot__util_8c_ae443765b508c1d69ac5249ef9de2bb81_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{phot__util_8c_ae443765b508c1d69ac5249ef9de2bb81_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{phot__util_8c_a67e3cb7a7d0cd3d55277fc4f3373fe2e}\label{phot__util_8c_a67e3cb7a7d0cd3d55277fc4f3373fe2e}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!ds\+\_\+to\+\_\+sphere@{ds\+\_\+to\+\_\+sphere}}
\index{ds\+\_\+to\+\_\+sphere@{ds\+\_\+to\+\_\+sphere}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{ds\+\_\+to\+\_\+sphere()}{ds\_to\_sphere()}}
{\footnotesize\ttfamily double ds\+\_\+to\+\_\+sphere (\begin{DoxyParamCaption}\item[{double}]{r,  }\item[{struct \hyperlink{structphoton}{photon} $\ast$}]{p }\end{DoxyParamCaption})}



Calculate the pathlenth along a line of sight defined by a photon p to a sphere centered on the origin. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em double} & r The radius of the sphere \\
\hline
\mbox{\tt in,out}  & {\em struct} & photon $\ast$ p The photon \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The distance to the sphere. If the photon does not hit the sphere return a large number V\+E\+R\+Y\+\_\+\+B\+IG
\end{DoxyReturn}
The routine simply solves the quadratic equation for calculating the distance to the sphere. It returns the smalles positive root

\paragraph*{Notes}

Definition at line 531 of file phot\+\_\+util.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=225pt]{phot__util_8c_a67e3cb7a7d0cd3d55277fc4f3373fe2e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{phot__util_8c_a67e3cb7a7d0cd3d55277fc4f3373fe2e_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{phot__util_8c_a8656562abff4020df988426338e79eca}\label{phot__util_8c_a8656562abff4020df988426338e79eca}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!ds\+\_\+to\+\_\+sphere2@{ds\+\_\+to\+\_\+sphere2}}
\index{ds\+\_\+to\+\_\+sphere2@{ds\+\_\+to\+\_\+sphere2}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{ds\+\_\+to\+\_\+sphere2()}{ds\_to\_sphere2()}}
{\footnotesize\ttfamily double ds\+\_\+to\+\_\+sphere2 (\begin{DoxyParamCaption}\item[{\hyperlink{import__cylindrical_8c_a099bc7b5a9501685180c163c1ffb67d0}{x}}]{,  }\item[{}]{r,  }\item[{struct \hyperlink{structphoton}{photon} $\ast$}]{p }\end{DoxyParamCaption})}



Find the positive distance to a sphere centered at x with radius r. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em double} & x\mbox{[}\mbox{]} The center of the sphere \\
\hline
\mbox{\tt in,out}  & {\em double} & r The radius of the sphere \\
\hline
\mbox{\tt in,out}  & {\em struct} & photon $\ast$ p A photon \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The distance to the sphere. If the photon does not hit the sphere return a large number V\+E\+R\+Y\+\_\+\+B\+IG
\end{DoxyReturn}
The routine simply solves the quadratic equation for calculating the distance to the sphere. It returns the smalles positive root

\paragraph*{Notes}

It is not clear we need two routines like this, one which assumes that the sphere is centered on 0 and one which does not. 

Definition at line 605 of file phot\+\_\+util.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=229pt]{phot__util_8c_a8656562abff4020df988426338e79eca_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{phot__util_8c_a8f17a1e86112f24760862d998129d91c}\label{phot__util_8c_a8f17a1e86112f24760862d998129d91c}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!move\+\_\+phot@{move\+\_\+phot}}
\index{move\+\_\+phot@{move\+\_\+phot}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{move\+\_\+phot()}{move\_phot()}}
{\footnotesize\ttfamily int move\+\_\+phot (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{pp,  }\item[{double}]{ds }\end{DoxyParamCaption})}



move a photon by a distance ds 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em Phot\+Ptr} & pp A photon bundle \\
\hline
\mbox{\tt in}  & {\em double} & ds The distance to move the photon \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
The routine simply updates the position x of the photon using the current direction and the distance.

The path length for the photon is also updated for use in reverberation calculations

\paragraph*{Notes}

Definition at line 101 of file phot\+\_\+util.\+c.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{phot__util_8c_a8f17a1e86112f24760862d998129d91c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{phot__util_8c_a56bcc4eb80e38e626fe58bb5c989eafd}\label{phot__util_8c_a56bcc4eb80e38e626fe58bb5c989eafd}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!phot\+\_\+hist@{phot\+\_\+hist}}
\index{phot\+\_\+hist@{phot\+\_\+hist}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{phot\+\_\+hist()}{phot\_hist()}}
{\footnotesize\ttfamily int phot\+\_\+hist (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{int}]{iswitch }\end{DoxyParamCaption})}



Record the history of a single photon bundle, in terms of a series of photon structures that are populated as the photon goes through the grid. 

Unless phot\+\_\+hist\+\_\+on is true, then this routine is a N\+OP


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em Phot\+Ptr} & p A photon to track \\
\hline
\mbox{\tt in,out}  & {\em int} & iswitch A switch that resets \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns the number of photons which have been stored
\end{DoxyReturn}
This routine stores selected photons in an array, which one can use to see what is happening in a special case.

This is a diagnostic routine only

\paragraph*{Notes}

The routine is useful (at present) only in the context of a debugger since the array in which photons are stored is not written out. The basic idea is that one identifies a problem say with a specific photon and then stores the history of that photon in the array so once can inspect in detail what has happened to the photon.

\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000040}{Bug}]It is not obvious that this routine is needed as we now have another mechanism to write photons out to a file. In any event, this should be moved to some other place in the code.\end{DoxyRefDesc}


Definition at line 207 of file phot\+\_\+util.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{phot__util_8c_a56bcc4eb80e38e626fe58bb5c989eafd_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{phot__util_8c_a56bcc4eb80e38e626fe58bb5c989eafd_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{phot__util_8c_a13bf02e4a8315e90c84ae43b42fde4b6}\label{phot__util_8c_a13bf02e4a8315e90c84ae43b42fde4b6}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!phot\+\_\+history\+\_\+summarize@{phot\+\_\+history\+\_\+summarize}}
\index{phot\+\_\+history\+\_\+summarize@{phot\+\_\+history\+\_\+summarize}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{phot\+\_\+history\+\_\+summarize()}{phot\_history\_summarize()}}
{\footnotesize\ttfamily int phot\+\_\+history\+\_\+summarize (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



The next routine is designed to update a portion of the Plasma\+Ptr to reflect where photons along the line of sight to the observer were absorbed in the wind. 

$<$N\+O\+TE\+: The \mbox{[}in, out\mbox{]} tag describes if the value of a parameter is used or altered. If it is used but not altered, delete \textquotesingle{}O\+UT\textquotesingle{}. If the original value is not used and it is written to, delete \textquotesingle{}IN\textquotesingle{}.$>$ \begin{DoxyReturn}{Returns}
??? R\+E\+T\+U\+R\+NS ???
\end{DoxyReturn}
??? D\+E\+S\+C\+R\+I\+P\+T\+I\+ON ???

\paragraph*{Notes}

As photon is extracted from the wind, tau changes due to scatters and w changes due to absorption. We are just recording how much energy is absorbed by scatterng processes here, and so the energy absorbed is the current weight (exp(-\/tau\+\_\+before) -\/ exp (-\/tau\+\_\+after)) 

Definition at line 278 of file phot\+\_\+util.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{phot__util_8c_a13bf02e4a8315e90c84ae43b42fde4b6_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{phot__util_8c_a13bf02e4a8315e90c84ae43b42fde4b6_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{phot__util_8c_aba2cef648adc07ade76f313650e627ab}\label{phot__util_8c_aba2cef648adc07ade76f313650e627ab}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!quadratic@{quadratic}}
\index{quadratic@{quadratic}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{quadratic()}{quadratic()}}
{\footnotesize\ttfamily int quadratic (\begin{DoxyParamCaption}\item[{double}]{a,  }\item[{double}]{b,  }\item[{double}]{c,  }\item[{\hyperlink{import__spherical_8c_a83175ac8fd9d924ff2bce40c99e88870}{r}}]{ }\end{DoxyParamCaption})}



This solves a simple quadratic (or if a is zero linear) equation. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em double} & a The constant which multiples x$\ast$$\ast$2 in the quadratic equation \\
\hline
\mbox{\tt in}  & {\em double} & b The constant which multiples x \\
\hline
\mbox{\tt in}  & {\em double} & c The constant \\
\hline
\mbox{\tt out}  & {\em double} & r\mbox{[}\mbox{]} The roots of the quadratic equation \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The returns depend on the a status tha depends on the nature of the solutions The return is set up to make it easy to identify the smallest positive root if one exists. The routine returns a negative number if both roots are negative or imaginary. More specifically the routine returns
\begin{DoxyItemize}
\item -\/1 -\/$>$ both roots are imaginary
\item -\/2 -\/$>$ both roots are negative or 0
\item 0 -\/$>$ the first root is the smallest positive root
\item 1 -\/$>$ the second root is the smallest positive root
\end{DoxyItemize}
\end{DoxyReturn}
The equation that is solved is ax$\ast$$\ast$2+bx+c=0.

\paragraph*{Notes}

Definition at line 689 of file phot\+\_\+util.\+c.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=229pt]{phot__util_8c_aba2cef648adc07ade76f313650e627ab_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{phot__util_8c_a1c6dc9c24a43e2bc6319b23faba4a041}\label{phot__util_8c_a1c6dc9c24a43e2bc6319b23faba4a041}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!stuff\+\_\+phot@{stuff\+\_\+phot}}
\index{stuff\+\_\+phot@{stuff\+\_\+phot}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{stuff\+\_\+phot()}{stuff\_phot()}}
{\footnotesize\ttfamily int stuff\+\_\+phot (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{pin,  }\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{pout }\end{DoxyParamCaption})}



Simply copy one photon bundle into another. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Phot\+Ptr} & pin The photon bundle to be copied \\
\hline
\mbox{\tt out}  & {\em Phot\+Ptr} & pout The Phot\+Ptr that contains the output \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
This just a simple utility to copy a photon bundle

\paragraph*{Notes}

All variables are (or should be) copied. 

Definition at line 46 of file phot\+\_\+util.\+c.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{phot__util_8c_a1c6dc9c24a43e2bc6319b23faba4a041_icgraph}
\end{center}
\end{figure}


\subsection{Variable Documentation}
\mbox{\Hypertarget{phot__util_8c_a0791b17bafbcf6e30d7bbeffa2c1cec4}\label{phot__util_8c_a0791b17bafbcf6e30d7bbeffa2c1cec4}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!init\+\_\+stuff\+\_\+phot@{init\+\_\+stuff\+\_\+phot}}
\index{init\+\_\+stuff\+\_\+phot@{init\+\_\+stuff\+\_\+phot}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{init\+\_\+stuff\+\_\+phot}{init\_stuff\_phot}}
{\footnotesize\ttfamily int init\+\_\+stuff\+\_\+phot = 0}



Definition at line 25 of file phot\+\_\+util.\+c.

\mbox{\Hypertarget{phot__util_8c_ad063cb5ecb88d7c02392bcb4b84a942d}\label{phot__util_8c_ad063cb5ecb88d7c02392bcb4b84a942d}} 
\index{phot\+\_\+util.\+c@{phot\+\_\+util.\+c}!sizeofphot@{sizeofphot}}
\index{sizeofphot@{sizeofphot}!phot\+\_\+util.\+c@{phot\+\_\+util.\+c}}
\subsubsection{\texorpdfstring{sizeofphot}{sizeofphot}}
{\footnotesize\ttfamily size\+\_\+t sizeofphot}



Definition at line 26 of file phot\+\_\+util.\+c.

