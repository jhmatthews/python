\hypertarget{matrix__ion_8c}{}\section{/\+Users/mhewitt/python/source/matrix\+\_\+ion.c File Reference}
\label{matrix__ion_8c}\index{/\+Users/mhewitt/python/source/matrix\+\_\+ion.\+c@{/\+Users/mhewitt/python/source/matrix\+\_\+ion.\+c}}


Contains routines which compute the ionization state using a matrix inversion technique.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atomic.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}python.\+h\char`\"{}}\newline
{\ttfamily \#include $<$gsl/gsl\+\_\+block.\+h$>$}\newline
{\ttfamily \#include $<$gsl/gsl\+\_\+vector.\+h$>$}\newline
{\ttfamily \#include $<$gsl/gsl\+\_\+matrix.\+h$>$}\newline
{\ttfamily \#include \char`\"{}my\+\_\+linalg.\+h\char`\"{}}\newline
Include dependency graph for matrix\+\_\+ion.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{matrix__ion_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{matrix__ion_8c_a1e569c92136f73f8643f20d8fb43f544}{matrix\+\_\+ion\+\_\+populations} (\hyperlink{python_8h_a13ce7664e071685e1c3eaac3c32d7c8d}{Plasma\+Ptr} \hyperlink{compton_8c_ad65f0d74fe764d3ecae5ec1a89d63f08}{xplasma}, int mode)
\begin{DoxyCompactList}\small\item\em A matrix solver for the ionization state in a cell. \end{DoxyCompactList}\item 
int \hyperlink{matrix__ion_8c_aaa690e0a23766160c4cb48aa99783ead}{populate\+\_\+ion\+\_\+rate\+\_\+matrix} (rate\+\_\+matrix, pi\+\_\+rates, inner\+\_\+rates, rr\+\_\+rates, b\+\_\+temp, double xne)
\begin{DoxyCompactList}\small\item\em populates a rate\+\_\+matrix \end{DoxyCompactList}\item 
int \hyperlink{matrix__ion_8c_a37b054a7922fd8ef0a3c003f01b0aa2d}{solve\+\_\+matrix} (double $\ast$a\+\_\+data, double $\ast$b\+\_\+data, int nrows, double $\ast$\hyperlink{import__cylindrical_8c_a099bc7b5a9501685180c163c1ffb67d0}{x}, int nplasma)
\begin{DoxyCompactList}\small\item\em solves the matrix equation A x = b for the vector x. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Contains routines which compute the ionization state using a matrix inversion technique. 

\begin{DoxyAuthor}{Author}
ksl 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
January, 2018
\end{DoxyDate}
??? 

\subsection{Function Documentation}
\mbox{\Hypertarget{matrix__ion_8c_a1e569c92136f73f8643f20d8fb43f544}\label{matrix__ion_8c_a1e569c92136f73f8643f20d8fb43f544}} 
\index{matrix\+\_\+ion.\+c@{matrix\+\_\+ion.\+c}!matrix\+\_\+ion\+\_\+populations@{matrix\+\_\+ion\+\_\+populations}}
\index{matrix\+\_\+ion\+\_\+populations@{matrix\+\_\+ion\+\_\+populations}!matrix\+\_\+ion.\+c@{matrix\+\_\+ion.\+c}}
\subsubsection{\texorpdfstring{matrix\+\_\+ion\+\_\+populations()}{matrix\_ion\_populations()}}
{\footnotesize\ttfamily int matrix\+\_\+ion\+\_\+populations (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_a13ce7664e071685e1c3eaac3c32d7c8d}{Plasma\+Ptr}}]{xplasma,  }\item[{int}]{mode }\end{DoxyParamCaption})}



A matrix solver for the ionization state in a cell. 


\begin{DoxyParams}{Parameters}
{\em \mbox{[}in} & out\mbox{]} Plasma\+Ptr xplasma The plasma cell we are working on \\
\hline
{\em \mbox{[}in} & out\mbox{]} int mode What type of model to use for J\+\_\+nu -\/ 1=fitted model 2=blackbody \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 if successful
\end{DoxyReturn}
modes\+: 1 -\/ use a power law and or exponential model for J 2 -\/ use a dilute BB model for J defined by t\+\_\+r and w The general structure of matrix\+\_\+ion\+\_\+populations is as follows\+: First we compute all of the rates that we have data for linking all ionization stages We make an initial guess at the electron density We attempt to solve the ionization rates matrix, and produce a new guess at the electron density We then calculate new rates, re-\/solve and proceed until the electron density converges. We solve the matrix equation A x = b for the vector x, where A is a square rate matrix linking each state with each other state (often containing zeros if the ions arent linked) b is a vector containing the total density of each element arranged in a certain way (see later) and x is a vector containing the relative ion populations. We invert A to get x=b\+A$^\wedge$-\/1

\paragraph*{Notes}

Uses a relative abundance scheme -\/ reduces large number issues 

Definition at line 57 of file matrix\+\_\+ion.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{matrix__ion_8c_a1e569c92136f73f8643f20d8fb43f544_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=304pt]{matrix__ion_8c_a1e569c92136f73f8643f20d8fb43f544_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{matrix__ion_8c_aaa690e0a23766160c4cb48aa99783ead}\label{matrix__ion_8c_aaa690e0a23766160c4cb48aa99783ead}} 
\index{matrix\+\_\+ion.\+c@{matrix\+\_\+ion.\+c}!populate\+\_\+ion\+\_\+rate\+\_\+matrix@{populate\+\_\+ion\+\_\+rate\+\_\+matrix}}
\index{populate\+\_\+ion\+\_\+rate\+\_\+matrix@{populate\+\_\+ion\+\_\+rate\+\_\+matrix}!matrix\+\_\+ion.\+c@{matrix\+\_\+ion.\+c}}
\subsubsection{\texorpdfstring{populate\+\_\+ion\+\_\+rate\+\_\+matrix()}{populate\_ion\_rate\_matrix()}}
{\footnotesize\ttfamily int populate\+\_\+ion\+\_\+rate\+\_\+matrix (\begin{DoxyParamCaption}\item[{rate\+\_\+matrix}]{,  }\item[{pi\+\_\+rates}]{,  }\item[{inner\+\_\+rates}]{,  }\item[{rr\+\_\+rates}]{,  }\item[{b\+\_\+temp}]{,  }\item[{double}]{xne }\end{DoxyParamCaption})}



populates a rate\+\_\+matrix 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em double} & rate\+\_\+matrix\mbox{[}nions\mbox{]}\mbox{[}nions\mbox{]} -\/ the rate matrix that will be filled by this array \\
\hline
\mbox{\tt in}  & {\em double} & pi\+\_\+rates\mbox{[}nions\mbox{]} -\/ vector of photionization rates \\
\hline
\mbox{\tt in}  & {\em double} & inner\+\_\+rates\mbox{[}n\+\_\+inner\+\_\+tot\mbox{]} -\/ vector of inner shell photoionization rates \\
\hline
\mbox{\tt in}  & {\em double} & rr\+\_\+rates\mbox{[}nions\mbox{]} -\/ vector of radiative recobination rates \\
\hline
\mbox{\tt out}  & {\em double} & b\+\_\+temp\mbox{[}nions\mbox{]} -\/ the vector of total elemental densities that we also fill here \\
\hline
\mbox{\tt in}  & {\em double} & xne -\/ current electron density \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/ zero if successful
\end{DoxyReturn}
populate\+\_\+ion\+\_\+rate\+\_\+matrix populates a rate\+\_\+matrix of shape nions x nions with the pi\+\_\+rates and rr\+\_\+rates supplied at the density xne in question. It also populates the b matrix -\/ that is the total elemental abundance -\/ we use relative abundances so this is just a set of 1s and 0s.

\paragraph*{Notes}

This routine includes the process of replacing the first row of the matrix with 1s in order to make the problem soluble. 

Definition at line 420 of file matrix\+\_\+ion.\+c.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=311pt]{matrix__ion_8c_aaa690e0a23766160c4cb48aa99783ead_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{matrix__ion_8c_a37b054a7922fd8ef0a3c003f01b0aa2d}\label{matrix__ion_8c_a37b054a7922fd8ef0a3c003f01b0aa2d}} 
\index{matrix\+\_\+ion.\+c@{matrix\+\_\+ion.\+c}!solve\+\_\+matrix@{solve\+\_\+matrix}}
\index{solve\+\_\+matrix@{solve\+\_\+matrix}!matrix\+\_\+ion.\+c@{matrix\+\_\+ion.\+c}}
\subsubsection{\texorpdfstring{solve\+\_\+matrix()}{solve\_matrix()}}
{\footnotesize\ttfamily int solve\+\_\+matrix (\begin{DoxyParamCaption}\item[{double $\ast$}]{a\+\_\+data,  }\item[{double $\ast$}]{b\+\_\+data,  }\item[{int}]{nrows,  }\item[{double $\ast$}]{x,  }\item[{int}]{nplasma }\end{DoxyParamCaption})}



solves the matrix equation A x = b for the vector x. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em double} & a\+\_\+data -\/ the square rate matric \\
\hline
\mbox{\tt in}  & {\em double} & b\+\_\+data -\/ the vector of total elemental abundances \\
\hline
\mbox{\tt in}  & {\em int} & nrows -\/ the number of rows (and columns) in the a matrix \\
\hline
\mbox{\tt out}  & {\em double} & x -\/ the ionic abundances calculated here \\
\hline
\mbox{\tt in}  & {\em int} & nplasma -\/ the index of the plasma cell we are working on -\/ only used for reporting errors \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
int ierr -\/ a number defining any error state
\end{DoxyReturn}
Performs a matrix inversion to solve Ax=b for x. Most of the algorithms used for this are from the gsl library

\paragraph*{Notes}

??? N\+O\+T\+ES ??? 

Definition at line 632 of file matrix\+\_\+ion.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{matrix__ion_8c_a37b054a7922fd8ef0a3c003f01b0aa2d_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=269pt]{matrix__ion_8c_a37b054a7922fd8ef0a3c003f01b0aa2d_icgraph}
\end{center}
\end{figure}
