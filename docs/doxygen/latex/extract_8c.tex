\hypertarget{extract_8c}{}\section{/\+Users/mhewitt/python/source/extract.c File Reference}
\label{extract_8c}\index{/\+Users/mhewitt/python/source/extract.\+c@{/\+Users/mhewitt/python/source/extract.\+c}}


Maing routines for extracting photons during the spectral generation phase.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atomic.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}python.\+h\char`\"{}}\newline
Include dependency graph for extract.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{extract_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{extract_8c_a280fcbb3dddfaf58a73b2a8d6fd61c76}{extract} (\hyperlink{python_8h_ad957272e4ddecfb558775b2aeddf2ac4}{Wind\+Ptr} w, \hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} p, int itype)
\begin{DoxyCompactList}\small\item\em A supervisory routine called to builds detailed spectra in the normal (extract) mode. \end{DoxyCompactList}\item 
int \hyperlink{extract_8c_a1aaecc045729b48d2ede700108567dcd}{extract\+\_\+one} (\hyperlink{python_8h_ad957272e4ddecfb558775b2aeddf2ac4}{Wind\+Ptr} w, \hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr} pp, int itype, int nspec)
\begin{DoxyCompactList}\small\item\em (w,pp,itype,nspec) \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Maing routines for extracting photons during the spectral generation phase. 

\begin{DoxyAuthor}{Author}
ksl 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
April, 2018 
\end{DoxyDate}


\subsection{Function Documentation}
\mbox{\Hypertarget{extract_8c_a280fcbb3dddfaf58a73b2a8d6fd61c76}\label{extract_8c_a280fcbb3dddfaf58a73b2a8d6fd61c76}} 
\index{extract.\+c@{extract.\+c}!extract@{extract}}
\index{extract@{extract}!extract.\+c@{extract.\+c}}
\subsubsection{\texorpdfstring{extract()}{extract()}}
{\footnotesize\ttfamily int extract (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad957272e4ddecfb558775b2aeddf2ac4}{Wind\+Ptr}}]{w,  }\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{p,  }\item[{int}]{itype }\end{DoxyParamCaption})}



A supervisory routine called to builds detailed spectra in the normal (extract) mode. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em Wind\+Ptr} & w The entire wind \\
\hline
\mbox{\tt in,out}  & {\em Phot\+Ptr} & p The photon to extract \\
\hline
\mbox{\tt in,out}  & {\em int} & itype An integer representing the type of photon for the purpose of being extracted. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
extract is called when a photon begins it\textquotesingle{}s flight and every time that photon scatters, unless the user has exercised the \char`\"{}live or die\char`\"{} option, in which case it is not called.

extract carries out several preperatory steps for the extraction and for each spectrum one wants to build, it calls extract\+\_\+one, where the actual incrementing of the spectrum is done.

itype takes on the following values\+:
\begin{DoxyItemize}
\item P\+T\+Y\+P\+E\+\_\+\+S\+T\+A\+R-\/$>$the photon came for the star
\item P\+T\+Y\+P\+E\+\_\+\+B\+L-\/$>$the photon came from the boundary layer
\item P\+T\+Y\+P\+E\+\_\+\+D\+I\+S\+K-\/$>$the photon being redirected arose in the disk,
\item P\+T\+Y\+P\+E\+\_\+\+W\+I\+N\+D-\/$>$the photon being redirected arose in the wind,
\end{DoxyItemize}

extract uses the types to prepare the photon for extraction, including doppler shifting the photon if is of P\+T\+Y\+P\+E\+\_\+\+W\+I\+ND or P\+T\+Y\+P\+E\+\_\+\+S\+T\+AR

Usually, Python constructs a spectrum of all photons, but there are advanced options which allone to restict the spectrum created to those produced with a certain number of scatters or from photons that arise from the above or below the disk. extract enforces those choices before calling extract\+\_\+one. The parameters for this option all come in through \hyperlink{python_8h}{python.\+h}, and are contained in the spectrum structure.

The basic choices, some of which can be used in tandom are as follows\+:


\begin{DoxyItemize}
\item If s\mbox{[}n\mbox{]}.nscat$>$999; then one obtains the entire spectrum
\item if s\mbox{[}n\mbox{]}.nscat is a positive number, then the spectrum is composed just of photons with that number of scatters
\item if s\mbox{[}n\mbox{]}.nscat is a negative number, then the spectrum contains all photons with $>$= the absolute value of s\mbox{[}n\mbox{]}.nscat
\item s\mbox{[}n\mbox{]}.top\+\_\+bot=0 -\/$>$ accept all photons
\item s\mbox{[}n\mbox{]}.top\+\_\+bot $>$0 -\/$>$ accept photons last above the disk
\item s\mbox{[}n\mbox{]}.top\+\_\+bot $<$0 -\/$>$ accept photons below the disk
\item One can also select photons that are to be extracted from a particular spherical region. \paragraph*{Notes}
\end{DoxyItemize}

\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000024}{Bug}]This routine as well as extract\+\_\+one have options for tracking the photon history. The routines are in \hyperlink{diag_8c}{diag.\+c} It is not clear that they have been used in a long time and so it may be worthwhile to remove them. Furthermore, we have established a new mechanism save\+\_\+phot for essentially this same task. This really should be consolidated. \end{DoxyRefDesc}


\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000025}{Bug}]This is also commented in the text, but there is a rather bizarre separation for where the photon frequency is updated and where the weight is update. The former is done in extract, while the latter is done in extract\+\_\+one. This is not an error precisely but makes the code more confusing than it needs to be.\end{DoxyRefDesc}


Definition at line 149 of file extract.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{extract_8c_a280fcbb3dddfaf58a73b2a8d6fd61c76_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{extract_8c_a280fcbb3dddfaf58a73b2a8d6fd61c76_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{extract_8c_a1aaecc045729b48d2ede700108567dcd}\label{extract_8c_a1aaecc045729b48d2ede700108567dcd}} 
\index{extract.\+c@{extract.\+c}!extract\+\_\+one@{extract\+\_\+one}}
\index{extract\+\_\+one@{extract\+\_\+one}!extract.\+c@{extract.\+c}}
\subsubsection{\texorpdfstring{extract\+\_\+one()}{extract\_one()}}
{\footnotesize\ttfamily int extract\+\_\+one (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_ad957272e4ddecfb558775b2aeddf2ac4}{Wind\+Ptr}}]{w,  }\item[{\hyperlink{python_8h_ad2424d53ebcf811656882a87e11b440c}{Phot\+Ptr}}]{pp,  }\item[{int}]{itype,  }\item[{int}]{nspec }\end{DoxyParamCaption})}



(w,pp,itype,nspec) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Wind\+Ptr} & w The entire wind \\
\hline
\mbox{\tt in}  & {\em Phot\+Ptr} & pp The photon to be extracted \\
\hline
\mbox{\tt in}  & {\em int} & itype The type of photon (star, disk, wind, etc) \\
\hline
\mbox{\tt in}  & {\em int} & nspec the spectrum which will be incremented \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The photon status after translation
\end{DoxyReturn}
extract\+\_\+one is analogous to the detailed portion of transphot except here the basic point is to calculate the optical depth through the plasma in a certain direction, and to increment the appropriate spectrum.

Unlike trans\+\_\+phot, this routine also checks to see if whether the photon hits the secondary star, if one exists.

\paragraph*{Notes}

The logic behind the weighting of the photons is described in Christian Knigge\textquotesingle{}s thesis in section 2.\+3.\+4. According to equation 2.\+19 Pc/\+Pw=12 cos(theta)$\ast$(1+b cos(theta)/(3+2b) where b=1.\+5 corresponds to the Eddington approximation.

In Python, and in extract and transphot in particular, tau generally refers to the tau associated with scattering processes, and the weight contains the effect of dimunition of the energy of the photon bundle due to pure absorption processes. So, in extract, we add pp-\/$>$w $\ast$ exp(-\/tau) to the spectrum.

Note that both linearly and logarithmically spaced spectra are produced. 

Definition at line 307 of file extract.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{extract_8c_a1aaecc045729b48d2ede700108567dcd_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{extract_8c_a1aaecc045729b48d2ede700108567dcd_icgraph}
\end{center}
\end{figure}
