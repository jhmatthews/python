\hypertarget{bands_8c}{}\section{/\+Users/mhewitt/python/source/bands.c File Reference}
\label{bands_8c}\index{/\+Users/mhewitt/python/source/bands.\+c@{/\+Users/mhewitt/python/source/bands.\+c}}


Setup the frequency bands used for stratified sampling and for recording spectra in wind cells.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atomic.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}python.\+h\char`\"{}}\newline
Include dependency graph for bands.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bands_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{bands_8c_a3513a64162c15d3d3d101c3d5ea2367f}{bands\+\_\+init} (int imode, struct \hyperlink{structxbands}{xbands} $\ast$band)
\begin{DoxyCompactList}\small\item\em This is the routine that initializes the bands. \end{DoxyCompactList}\item 
int \hyperlink{bands_8c_a900ff3bb7a80569abf42be1e2b00fd36}{freqs\+\_\+init} (double freqmin, double freqmax)
\begin{DoxyCompactList}\small\item\em This is the routine where the frequency boundaries for course spectra are established. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Setup the frequency bands used for stratified sampling and for recording spectra in wind cells. 

\begin{DoxyAuthor}{Author}
ksl 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
March , 2018
\end{DoxyDate}
The subroutines here deal with two related issues, how to choose how many photons or photon bundles to create in various wavelength ranges, and how to record the spectrum that pass through individual cells.

Photons, or photon bundles, in Python are created with certain frequency and carry a certain amount of energy. Without any kind of stratified sampling all of the photons would be createed with the same energy content and frequencies which sample the spectrum in equal energy entervals. The sum of energies of all of the photons bundles originating in, for example, a stellar photosphere would eqaul that of the luminostiy of the star.

Normally, however, Python uses a form of stratified sampling to assure we have photons in various energy bands. This is important, especially for calculating ionization rates since one needs enough photons above ionization edges to estimate the rate accurately. In banding, one choses a number of photons in a given frequency range and changes the energy of the photon bundle so that the proper normalization is obtained.

Once one has decided how many photons in what wave bands to generate one also needs to capture a crude spectrum in each cell of the grid at least for many of the ionization modes we use. The resolution needs to be good enough to allow for various important ionization edges, but not so fine that one cannot characterize the slope of the spectrum in each interval.

The routines init\+\_\+bands in this file sets up the bands to for creating photons based on various user inputs; it then calls freqs\+\_\+init that sets up the frequency boundaries for recoding the spectra. 

\subsection{Function Documentation}
\mbox{\Hypertarget{bands_8c_a3513a64162c15d3d3d101c3d5ea2367f}\label{bands_8c_a3513a64162c15d3d3d101c3d5ea2367f}} 
\index{bands.\+c@{bands.\+c}!bands\+\_\+init@{bands\+\_\+init}}
\index{bands\+\_\+init@{bands\+\_\+init}!bands.\+c@{bands.\+c}}
\subsubsection{\texorpdfstring{bands\+\_\+init()}{bands\_init()}}
{\footnotesize\ttfamily int bands\+\_\+init (\begin{DoxyParamCaption}\item[{int}]{imode,  }\item[{struct \hyperlink{structxbands}{xbands} $\ast$}]{band }\end{DoxyParamCaption})}



This is the routine that initializes the bands. 

Python uses a form of stratified sampling in an attempt to assure that there are photon bundles at (high, generally) frequencies

This is the routine that initializes the bands. There are a number of possiblilities for setting up the bands


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em int} & imode A switch used for determining how the bands are to be populated \\
\hline
\mbox{\tt out}  & {\em struct} & xbands $\ast$ band The structure that is populated with the band information \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The routine itself simply returns 0 on success
\end{DoxyReturn}
The outputs are passed to other routines through the pointer to xbands.

The currently allow modes are $\ast$0 Use temperature to define a single band $\ast$1 Use f1 and f2 to define a single band $\ast$2 Use t,f1 and f2, and hardwired bands to define multiple bands which have been tuned to be relevent to C\+Vs and other systems where a hot disk (T\+\_\+eff of about 100,000 K is assumed
\begin{DoxyItemize}
\item 3 Bands tuned for yso
\item 4 Query the user to specify an arbitrary set of bands
\item 5 Hardwired very wide bands for testing $\ast$6 Bands set up by nsh to test cloudy $\ast$7 Bands hardwired for A\+GN paper1 by nsh $\ast$8 Define bands in logarithmic intervals
\end{DoxyItemize}

\paragraph*{Notes}

10nov -\/ ksl -\/ X\+XX Some of the choices have checks to see whether the bands that are being set up lie within f1 and f2. Others do not. This seems like an error.

\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000003}{Bug}]At some point some of the banding needs to be tested systematically. We have tended to find a setup that we like and just use it.\end{DoxyRefDesc}


Definition at line 123 of file bands.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{bands_8c_a3513a64162c15d3d3d101c3d5ea2367f_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=200pt]{bands_8c_a3513a64162c15d3d3d101c3d5ea2367f_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{bands_8c_a900ff3bb7a80569abf42be1e2b00fd36}\label{bands_8c_a900ff3bb7a80569abf42be1e2b00fd36}} 
\index{bands.\+c@{bands.\+c}!freqs\+\_\+init@{freqs\+\_\+init}}
\index{freqs\+\_\+init@{freqs\+\_\+init}!bands.\+c@{bands.\+c}}
\subsubsection{\texorpdfstring{freqs\+\_\+init()}{freqs\_init()}}
{\footnotesize\ttfamily int freqs\+\_\+init (\begin{DoxyParamCaption}\item[{double}]{freqmin,  }\item[{double}]{freqmax }\end{DoxyParamCaption})}



This is the routine where the frequency boundaries for course spectra are established. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em double} & freqmin The minimum frequency \\
\hline
\mbox{\tt in,out}  & {\em double} & freqmax The maximum frequency \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Always returns 0
\end{DoxyReturn}
In addition to setting bands which define the photons that are generated one must define bands that approximated the spectra in a cell. One cannot store all of the photons and their weights. This routine creates boundaries for storring the spectra.

\paragraph*{Notes}

At present everything is hardwired. Two typs of banding are carred out, one for A\+G\+N/\+X-\/ray bianries, and one for stellar systems

freqmin and freqmax are used inorder to limit the total range of the spectral bands.

The results are stored in geo.\+xfreq 

Definition at line 608 of file bands.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=271pt]{bands_8c_a900ff3bb7a80569abf42be1e2b00fd36_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=283pt]{bands_8c_a900ff3bb7a80569abf42be1e2b00fd36_icgraph}
\end{center}
\end{figure}
