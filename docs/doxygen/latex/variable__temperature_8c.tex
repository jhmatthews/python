\hypertarget{variable__temperature_8c}{}\section{/\+Users/mhewitt/python/source/variable\+\_\+temperature.c File Reference}
\label{variable__temperature_8c}\index{/\+Users/mhewitt/python/source/variable\+\_\+temperature.\+c@{/\+Users/mhewitt/python/source/variable\+\_\+temperature.\+c}}


This file was created to contain all of the routines associated with calculating ionization using the so-\/called pair-\/wise dilute bb and pairwise power law models. Collectively these are sometimes referred to as variable temperature models. Both involve attempt to calculate ionic abundances using a temperature fixed for each pair of ions to make the uncorrected abundance ratio roughly equal to 1. There are then correction factors applied, either based upon a piece\+\_\+wise power law model of the true radiation field, or as a dilute blackbody.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atomic.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}python.\+h\char`\"{}}\newline
Include dependency graph for variable\+\_\+temperature.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{variable__temperature_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{variable__temperature_8c_a72d9769510683e30aeef87c2a255ebe4}{variable\+\_\+temperature} (\hyperlink{python_8h_a13ce7664e071685e1c3eaac3c32d7c8d}{Plasma\+Ptr} \hyperlink{compton_8c_ad65f0d74fe764d3ecae5ec1a89d63f08}{xplasma}, int mode)
\begin{DoxyCompactList}\small\item\em modifies the densities of ions, levels, and partition functions of ions within a cell of the wind based upon the mode, and other data contained within the Wind\+Ptr itself, such as t\+\_\+r, t\+\_\+e, w, based on the \char`\"{}mode\char`\"{}. \end{DoxyCompactList}\item 
double \hyperlink{variable__temperature_8c_a7f409d6ca8a15c6c341fdb1853104685}{pi\+\_\+correct} (double xtemp, int nion, \hyperlink{python_8h_a13ce7664e071685e1c3eaac3c32d7c8d}{Plasma\+Ptr} \hyperlink{compton_8c_ad65f0d74fe764d3ecae5ec1a89d63f08}{xplasma}, int mode)
\begin{DoxyCompactList}\small\item\em calculates the photoionization rate correction factor for the number density of two adjacent ions \end{DoxyCompactList}\item 
double \hyperlink{variable__temperature_8c_acadd7fa5bd8a9673141a0de53d002aba}{temp\+\_\+func} (double solv\+\_\+temp)
\begin{DoxyCompactList}\small\item\em the function minimised by zbrent to find a temperature when the ion ratios are one (so the logarithm will be 0), to avoid numerical problems. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{variable__temperature_8c_ab945ac94bbf146dfaa907ba4d96056a8}{niterate}
\item 
double \hyperlink{variable__temperature_8c_a22b96e587830e0d388b56b3e3a0e309f}{xxxne}
\item 
double \hyperlink{variable__temperature_8c_aa0da69c99e5458f3f3f4b5b7aec21848}{xip}
\item 
int \hyperlink{variable__temperature_8c_aa90a64c81e3e52de9a103e721fbd3b8e}{bb\+\_\+correct\+\_\+err} = 0
\end{DoxyCompactItemize}


\subsection{Detailed Description}
This file was created to contain all of the routines associated with calculating ionization using the so-\/called pair-\/wise dilute bb and pairwise power law models. Collectively these are sometimes referred to as variable temperature models. Both involve attempt to calculate ionic abundances using a temperature fixed for each pair of ions to make the uncorrected abundance ratio roughly equal to 1. There are then correction factors applied, either based upon a piece\+\_\+wise power law model of the true radiation field, or as a dilute blackbody. 

\begin{DoxyAuthor}{Author}
nsh,ksl 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
May, 2018 
\end{DoxyDate}


\subsection{Function Documentation}
\mbox{\Hypertarget{variable__temperature_8c_a7f409d6ca8a15c6c341fdb1853104685}\label{variable__temperature_8c_a7f409d6ca8a15c6c341fdb1853104685}} 
\index{variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}!pi\+\_\+correct@{pi\+\_\+correct}}
\index{pi\+\_\+correct@{pi\+\_\+correct}!variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}}
\subsubsection{\texorpdfstring{pi\+\_\+correct()}{pi\_correct()}}
{\footnotesize\ttfamily double pi\+\_\+correct (\begin{DoxyParamCaption}\item[{double}]{xtemp,  }\item[{int}]{nion,  }\item[{\hyperlink{python_8h_a13ce7664e071685e1c3eaac3c32d7c8d}{Plasma\+Ptr}}]{xplasma,  }\item[{int}]{mode }\end{DoxyParamCaption})}



calculates the photoionization rate correction factor for the number density of two adjacent ions 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em double} & xtemp the temperature at which the saha abundances were calculated \\
\hline
\mbox{\tt in}  & {\em int} & nion number of the upper ion in the pair for which the correction factor is \\
\hline
\mbox{\tt in}  & {\em Plasma\+Ptr} & xplasma The cell currnently under test -\/ this supplied the code with \\
\hline
\mbox{\tt in}  & {\em int} & mode This is the ionization mode, which should be either I\+O\+N\+M\+O\+D\+E\+\_\+\+P\+A\+I\+R\+W\+I\+S\+E\+\_\+\+M\+L93 (6) or I\+O\+N\+M\+O\+D\+E\+\_\+\+P\+A\+I\+R\+W\+I\+S\+E\+\_\+\+S\+P\+E\+C\+T\+R\+A\+L\+M\+O\+D\+EL (7) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the photoionization rate correction factor
\end{DoxyReturn}
In I\+O\+N\+M\+O\+D\+E\+\_\+\+P\+A\+I\+R\+W\+I\+S\+E\+\_\+\+M\+L93, the correction factor is calculated assuming a dilute BB function. In I\+O\+N\+M\+O\+D\+E\+\_\+\+P\+A\+I\+R\+W\+I\+S\+E\+\_\+\+S\+P\+E\+C\+T\+R\+A\+L\+M\+O\+D\+EL the factor is calculated using a piecewise power law or exponentila function.

\paragraph*{Notes}

LM is a special case of this where the temperatures are the same. 

Definition at line 446 of file variable\+\_\+temperature.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=222pt]{variable__temperature_8c_a7f409d6ca8a15c6c341fdb1853104685_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{variable__temperature_8c_a7f409d6ca8a15c6c341fdb1853104685_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{variable__temperature_8c_acadd7fa5bd8a9673141a0de53d002aba}\label{variable__temperature_8c_acadd7fa5bd8a9673141a0de53d002aba}} 
\index{variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}!temp\+\_\+func@{temp\+\_\+func}}
\index{temp\+\_\+func@{temp\+\_\+func}!variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}}
\subsubsection{\texorpdfstring{temp\+\_\+func()}{temp\_func()}}
{\footnotesize\ttfamily double temp\+\_\+func (\begin{DoxyParamCaption}\item[{double}]{solv\+\_\+temp }\end{DoxyParamCaption})}



the function minimised by zbrent to find a temperature when the ion ratios are one (so the logarithm will be 0), to avoid numerical problems. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em double} & solv\+\_\+temp The temperature where the ??? \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The result of the temp\+\_\+func calculation
\end{DoxyReturn}
It is the natural log of the saha equation with the ne taken to the R\+HS. The correction factors are applied after and depend on the temperature we find.

\paragraph*{Notes}

xxxne and xip are global variables which is declared above and assigned in the main variable\+\_\+temperature routine. 

Definition at line 548 of file variable\+\_\+temperature.\+c.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{variable__temperature_8c_acadd7fa5bd8a9673141a0de53d002aba_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{variable__temperature_8c_a72d9769510683e30aeef87c2a255ebe4}\label{variable__temperature_8c_a72d9769510683e30aeef87c2a255ebe4}} 
\index{variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}!variable\+\_\+temperature@{variable\+\_\+temperature}}
\index{variable\+\_\+temperature@{variable\+\_\+temperature}!variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}}
\subsubsection{\texorpdfstring{variable\+\_\+temperature()}{variable\_temperature()}}
{\footnotesize\ttfamily int variable\+\_\+temperature (\begin{DoxyParamCaption}\item[{\hyperlink{python_8h_a13ce7664e071685e1c3eaac3c32d7c8d}{Plasma\+Ptr}}]{xplasma,  }\item[{int}]{mode }\end{DoxyParamCaption})}



modifies the densities of ions, levels, and partition functions of ions within a cell of the wind based upon the mode, and other data contained within the Wind\+Ptr itself, such as t\+\_\+r, t\+\_\+e, w, based on the \char`\"{}mode\char`\"{}. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em Plasma\+Ptr} & xplasma A Plasma cell \\
\hline
\mbox{\tt in}  & {\em int} & mode A choice of N\+E\+B\+U\+L\+A\+R\+M\+O\+D\+E\+\_\+\+P\+A\+I\+R\+W\+I\+S\+E\+\_\+\+M\+L93 (6) which uses a dilute blackbody to represent the spectrum or N\+E\+B\+U\+L\+A\+R\+M\+O\+D\+E\+\_\+\+P\+A\+I\+R\+W\+I\+S\+E\+\_\+\+S\+P\+E\+C\+T\+R\+A\+L\+M\+O\+D\+EL (7) which uses a crude spectrum constructed of power law or exponetial segments. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
returns 0 if the routine converged to an answer, -\/1 otherwise. On an abnormal return the density array and ne are left unchanged.
\end{DoxyReturn}
variable temperature alters portions of the variables associated with the Plasma cellr. Exactly how things are changed depends on the mode.

\paragraph*{Notes}

Section 5.\+3 of Nick\textquotesingle{}s thesis explains the undelying ratinale for the so-\/called variable temperature models. The name of the routine is misleading since there correctios are made for both a dilute power law and for a dilute bb.

Unlike nebular\+\_\+concentrations, this code works on pairs of ions at a time, and uses a temperature calculated to be suitable for that particular pair to have a ratio of abundances about equal to 1.

\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000062}{Bug}]There are various questions associated with this routine about whether what is being done associated with partition funcitons is correct.\end{DoxyRefDesc}


Definition at line 135 of file variable\+\_\+temperature.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{variable__temperature_8c_a72d9769510683e30aeef87c2a255ebe4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=297pt]{variable__temperature_8c_a72d9769510683e30aeef87c2a255ebe4_icgraph}
\end{center}
\end{figure}


\subsection{Variable Documentation}
\mbox{\Hypertarget{variable__temperature_8c_aa90a64c81e3e52de9a103e721fbd3b8e}\label{variable__temperature_8c_aa90a64c81e3e52de9a103e721fbd3b8e}} 
\index{variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}!bb\+\_\+correct\+\_\+err@{bb\+\_\+correct\+\_\+err}}
\index{bb\+\_\+correct\+\_\+err@{bb\+\_\+correct\+\_\+err}!variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}}
\subsubsection{\texorpdfstring{bb\+\_\+correct\+\_\+err}{bb\_correct\_err}}
{\footnotesize\ttfamily int bb\+\_\+correct\+\_\+err = 0}



Definition at line 420 of file variable\+\_\+temperature.\+c.

\mbox{\Hypertarget{variable__temperature_8c_ab945ac94bbf146dfaa907ba4d96056a8}\label{variable__temperature_8c_ab945ac94bbf146dfaa907ba4d96056a8}} 
\index{variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}!niterate@{niterate}}
\index{niterate@{niterate}!variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}}
\subsubsection{\texorpdfstring{niterate}{niterate}}
{\footnotesize\ttfamily int niterate}

Make this a variable that all the subroutines cn see, so we can decide if we need to recompute the numerators 

Definition at line 35 of file variable\+\_\+temperature.\+c.

\mbox{\Hypertarget{variable__temperature_8c_aa0da69c99e5458f3f3f4b5b7aec21848}\label{variable__temperature_8c_aa0da69c99e5458f3f3f4b5b7aec21848}} 
\index{variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}!xip@{xip}}
\index{xip@{xip}!variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}}
\subsubsection{\texorpdfstring{xip}{xip}}
{\footnotesize\ttfamily double xip}



Definition at line 94 of file variable\+\_\+temperature.\+c.

\mbox{\Hypertarget{variable__temperature_8c_a22b96e587830e0d388b56b3e3a0e309f}\label{variable__temperature_8c_a22b96e587830e0d388b56b3e3a0e309f}} 
\index{variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}!xxxne@{xxxne}}
\index{xxxne@{xxxne}!variable\+\_\+temperature.\+c@{variable\+\_\+temperature.\+c}}
\subsubsection{\texorpdfstring{xxxne}{xxxne}}
{\footnotesize\ttfamily double xxxne}



Definition at line 94 of file variable\+\_\+temperature.\+c.

