\hypertarget{get__models_8c}{}\section{/\+Users/mhewitt/python/source/get\+\_\+models.c File Reference}
\label{get__models_8c}\index{/\+Users/mhewitt/python/source/get\+\_\+models.\+c@{/\+Users/mhewitt/python/source/get\+\_\+models.\+c}}


The routines here provide a way to read grids of models and then to interpolate between them.  


{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$strings.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atomic.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}python.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}models.\+h\char`\"{}}\newline
Include dependency graph for get\+\_\+models.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{get__models_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{get__models_8c_a38eb76aa0a9a1bb1dac30c75be4a05b6}{B\+IG}~1e32
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{get__models_8c_a59b857f2f3debe87e91f33a5e01be07c}{get\+\_\+models} (modellist, int npars, int $\ast$spectype)
\begin{DoxyCompactList}\small\item\em This routine reads in a set of models for use in generation of spectra, e.\+g. a set of Kurucz stellar atmospheres which can used to simulate a disk, given a run of temperature and gravity. \end{DoxyCompactList}\item 
int \hyperlink{get__models_8c_a1c22576993d87a5e2ca959c5ca662e70}{get\+\_\+one\+\_\+model} (filename, struct \hyperlink{struct_model}{Model} $\ast$onemod)
\begin{DoxyCompactList}\small\item\em reads a single model file from disk and puts the result into the structure onemod \end{DoxyCompactList}\item 
int \hyperlink{get__models_8c_a17cbe892d03676c0123c4b578d6534d0}{model} (int spectype, par)
\begin{DoxyCompactList}\small\item\em interpolates between spectra in a grid placing the results in comp\mbox{[}spectype\mbox{]}.xmod \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{get__models_8c_a6c2d8e607e9d5955c71062389ea8c7e9}{get\+\_\+models\+\_\+init} = 0
\begin{DoxyCompactList}\small\item\em Needed so can initialize nmods\+\_\+tot the first time this routine is called. \end{DoxyCompactList}\item 
int \hyperlink{get__models_8c_af44ef37e3c3faa319a9786405fba5b2a}{nmodel\+\_\+error} = 0
\item 
int \hyperlink{get__models_8c_a025ef5f25888471473393860af969739}{nmodel\+\_\+terror} = 0
\end{DoxyCompactItemize}


\subsection{Detailed Description}
The routines here provide a way to read grids of models and then to interpolate between them. 

\begin{DoxyAuthor}{Author}
ksl 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
March, 2018
\end{DoxyDate}
\begin{DoxyVerb}There are two main routines

    get_models (modellist, npars, spectype)

which reads a list of models

and

    model (spectype, par)

which given a set of parameters will interpolate between modles
given the set of models one wants to interpolate betwee, which
is determined by spectype, and the set of parameters (par) that
define the models
\end{DoxyVerb}


\paragraph*{Notes}

A detailed understanding of these routines requires an understandig of the associated data structures which are in \hyperlink{models_8h}{models.\+h}

The individual models are contained in a stucture called Models

A summary of a set of models is contained in \hyperlink{struct_mod_sum}{Mod\+Sum}, along with a interpolated model generated by the routine model

get\+\_\+models is called as part of the initialization process.

model is called as one generates photons for specific raddiation sources, e.\+g the disk. It stores a spectrum/cdf of that spectrum in \hyperlink{struct_mod_sum}{Mod\+Sum}, which can be used to genreate photons for that spectrum. 

\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{get__models_8c_a38eb76aa0a9a1bb1dac30c75be4a05b6}\label{get__models_8c_a38eb76aa0a9a1bb1dac30c75be4a05b6}} 
\index{get\+\_\+models.\+c@{get\+\_\+models.\+c}!B\+IG@{B\+IG}}
\index{B\+IG@{B\+IG}!get\+\_\+models.\+c@{get\+\_\+models.\+c}}
\subsubsection{\texorpdfstring{B\+IG}{BIG}}
{\footnotesize\ttfamily \#define B\+IG~1e32}



Definition at line 56 of file get\+\_\+models.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{get__models_8c_a59b857f2f3debe87e91f33a5e01be07c}\label{get__models_8c_a59b857f2f3debe87e91f33a5e01be07c}} 
\index{get\+\_\+models.\+c@{get\+\_\+models.\+c}!get\+\_\+models@{get\+\_\+models}}
\index{get\+\_\+models@{get\+\_\+models}!get\+\_\+models.\+c@{get\+\_\+models.\+c}}
\subsubsection{\texorpdfstring{get\+\_\+models()}{get\_models()}}
{\footnotesize\ttfamily int get\+\_\+models (\begin{DoxyParamCaption}\item[{modellist}]{,  }\item[{int}]{npars,  }\item[{int $\ast$}]{spectype }\end{DoxyParamCaption})}



This routine reads in a set of models for use in generation of spectra, e.\+g. a set of Kurucz stellar atmospheres which can used to simulate a disk, given a run of temperature and gravity. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em char} & modellist\mbox{[}\mbox{]} filename containing location and associated parameters of models \\
\hline
\mbox{\tt in}  & {\em int} & npars Number of parameters which vary for these models \\
\hline
\mbox{\tt out}  & {\em int} & $\ast$ spectype spectype an integer that is incremented each time a new set of models is read in \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
$\ast$spectype is also returned
\end{DoxyReturn}
These are a generic set of routines to read a grid or grids of models, e.\+g. a set of Kurucz stellar atmospheres which can used to simulate a disk, given a run of temperature and gravity

The grid can be any reasonable number of dimension

\paragraph*{Notes}

Basically, the way this works is as followsL

modellist is a file that cantains a list of models, and the parameters that are associated with each model. (There can be mulitple parameters associated with each file. Typically these are temperature, and gravity, but these routines are generic, and so one could image that the the spectra are organized quite differently

Each model, that is read in contains a list of wavelengths and a flux, that should be proportional to flambda.

There are some assumptions that are made in terms of the order in the modellist file. Specifically"

\begin{DoxyVerb}For 1d models we assume the models are read in increasing order of
the parameter of interest.

2 or more parameter models can be read in any order.  Bilinear interpolation
is done for the 2 parameter models (as long as the grid is fully filled).


To deal with cases in which the grid is not fully filled, we follow
the same approach as for get_hub, i.e. for parameters t and g (i.e.
the first parameter being t, and the second g., we first search the grid
for all models with t just below (above) the desired value.  We then
interpolate on g for the model just below, and on g for the model just
above, and finally interpolate between these two.
The algorithm for interpolating between models


Note that each time a new set of models is read in, the spectype is
incremented.\end{DoxyVerb}
 

Definition at line 124 of file get\+\_\+models.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{get__models_8c_a59b857f2f3debe87e91f33a5e01be07c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=232pt]{get__models_8c_a59b857f2f3debe87e91f33a5e01be07c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{get__models_8c_a1c22576993d87a5e2ca959c5ca662e70}\label{get__models_8c_a1c22576993d87a5e2ca959c5ca662e70}} 
\index{get\+\_\+models.\+c@{get\+\_\+models.\+c}!get\+\_\+one\+\_\+model@{get\+\_\+one\+\_\+model}}
\index{get\+\_\+one\+\_\+model@{get\+\_\+one\+\_\+model}!get\+\_\+models.\+c@{get\+\_\+models.\+c}}
\subsubsection{\texorpdfstring{get\+\_\+one\+\_\+model()}{get\_one\_model()}}
{\footnotesize\ttfamily int get\+\_\+one\+\_\+model (\begin{DoxyParamCaption}\item[{filename}]{,  }\item[{struct \hyperlink{struct_model}{Model} $\ast$}]{onemod }\end{DoxyParamCaption})}



reads a single model file from disk and puts the result into the structure onemod 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em char} & filename\mbox{[}\mbox{]} The name of the file containing the model \\
\hline
\mbox{\tt in}  & {\em struct} & \hyperlink{struct_model}{Model} $\ast$ onemod A pointer to the structure where the model is to be stored \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of wavelengths and fluxes read from the file
\end{DoxyReturn}
This is simply a utility routine called by get\+\_\+models to read in a single model into the modle stucture 

Definition at line 290 of file get\+\_\+models.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{get__models_8c_a1c22576993d87a5e2ca959c5ca662e70_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=336pt]{get__models_8c_a1c22576993d87a5e2ca959c5ca662e70_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{get__models_8c_a17cbe892d03676c0123c4b578d6534d0}\label{get__models_8c_a17cbe892d03676c0123c4b578d6534d0}} 
\index{get\+\_\+models.\+c@{get\+\_\+models.\+c}!model@{model}}
\index{model@{model}!get\+\_\+models.\+c@{get\+\_\+models.\+c}}
\subsubsection{\texorpdfstring{model()}{model()}}
{\footnotesize\ttfamily int model (\begin{DoxyParamCaption}\item[{int}]{spectype,  }\item[{par}]{ }\end{DoxyParamCaption})}



interpolates between spectra in a grid placing the results in comp\mbox{[}spectype\mbox{]}.xmod 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em int} & spectype A number which refers to a specific collecton of models, which were read in \\
\hline
\mbox{\tt in}  & {\em double} & par\mbox{[}\mbox{]} An array that contains the parameters for the models we want to interpoalted, e.\+g \mbox{[}T, grav\mbox{]} \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Returns nwaves in the the spectrum if a new spectrum was calculated 0 if it was the old spectrum.
\end{DoxyReturn}
This is an intepolation routine. Having previously read in a set of models which are associated with a set of parameter, e.\+g T and g, we want the spectrum at some t and g, which is not necessaily in the grid. This routien does the interpolation and stores the result in comp\mbox{[}spectype\mbox{]}.mod

The routine is generic as long as the requested parameters are within the grid of models, but the routine makes the assumption that the first parameter is a temperature if the value of the first parameter outside the range of that parameter.

\paragraph*{Notes}

If the parameters for the interpolated routine are within the grid of models, and the grid is fully filled, then a straighfoward interpolation is carried out.

If models are missing from the grid or if the requested model has parameters which are outside the grid, an \char`\"{}interpolated\char`\"{} model is still returned but assumptions are made which are intended to provide a reasonable solution for the case, where the first parameter is a temperature, and the second parameter is a gravity.

Specfically, for a missing model, the first thing that happens is that the routine first ignores the missing model treating each of the others as if bi-\/linear interpolation was being used, and then renormalizing to make sure the weights of the models that one does have sum to 1. The solution is \char`\"{}practical\char`\"{} because it always gives a result, and because it gives the an appropriate answer when the grid is filled. It is also easily extensible to more than two dimensions. But it should be noted, the approach is also dangerous.

Lastly, if the first parameter is out of range, it assumes that the first parameter was a temperature, and it modifies the spectrum by the ratio of a BB speccturm for the desired spectrum to the temperature of the max/min temperature in the grid. So for example, suppose the models which were read in were for Kuruce models, which run out a temperature of about 50,000k and you wnat the spectrum of a star which is 100,000K. Then the routine will deliver a spectrum which has line features of a 50,000K star, but an overall specturm which has the shape of a 100,000 K BB. This is not a good situation for this extreme case, but may be reasonable if the temperature differences are less extreme. 

Definition at line 383 of file get\+\_\+models.\+c.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{get__models_8c_a17cbe892d03676c0123c4b578d6534d0_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{get__models_8c_a17cbe892d03676c0123c4b578d6534d0_icgraph}
\end{center}
\end{figure}


\subsection{Variable Documentation}
\mbox{\Hypertarget{get__models_8c_a6c2d8e607e9d5955c71062389ea8c7e9}\label{get__models_8c_a6c2d8e607e9d5955c71062389ea8c7e9}} 
\index{get\+\_\+models.\+c@{get\+\_\+models.\+c}!get\+\_\+models\+\_\+init@{get\+\_\+models\+\_\+init}}
\index{get\+\_\+models\+\_\+init@{get\+\_\+models\+\_\+init}!get\+\_\+models.\+c@{get\+\_\+models.\+c}}
\subsubsection{\texorpdfstring{get\+\_\+models\+\_\+init}{get\_models\_init}}
{\footnotesize\ttfamily int get\+\_\+models\+\_\+init = 0}



Needed so can initialize nmods\+\_\+tot the first time this routine is called. 



Definition at line 62 of file get\+\_\+models.\+c.

\mbox{\Hypertarget{get__models_8c_af44ef37e3c3faa319a9786405fba5b2a}\label{get__models_8c_af44ef37e3c3faa319a9786405fba5b2a}} 
\index{get\+\_\+models.\+c@{get\+\_\+models.\+c}!nmodel\+\_\+error@{nmodel\+\_\+error}}
\index{nmodel\+\_\+error@{nmodel\+\_\+error}!get\+\_\+models.\+c@{get\+\_\+models.\+c}}
\subsubsection{\texorpdfstring{nmodel\+\_\+error}{nmodel\_error}}
{\footnotesize\ttfamily int nmodel\+\_\+error = 0}



Definition at line 330 of file get\+\_\+models.\+c.

\mbox{\Hypertarget{get__models_8c_a025ef5f25888471473393860af969739}\label{get__models_8c_a025ef5f25888471473393860af969739}} 
\index{get\+\_\+models.\+c@{get\+\_\+models.\+c}!nmodel\+\_\+terror@{nmodel\+\_\+terror}}
\index{nmodel\+\_\+terror@{nmodel\+\_\+terror}!get\+\_\+models.\+c@{get\+\_\+models.\+c}}
\subsubsection{\texorpdfstring{nmodel\+\_\+terror}{nmodel\_terror}}
{\footnotesize\ttfamily int nmodel\+\_\+terror = 0}



Definition at line 331 of file get\+\_\+models.\+c.

